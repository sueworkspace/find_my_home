"""
KB부동산(kbland.kr) 내부 API를 이용한 KB시세 조회 클라이언트

kbland.kr 프론트엔드가 호출하는 api.kbland.kr 내부 API를 역분석한 엔드포인트를 사용합니다.
비상업적 개인 사용 목적이며, rate limiting을 준수합니다.

주요 기능:
- 법정동코드로 해당 지역 아파트 단지 목록 조회
- 단지별 면적 타입 정보 조회
- 면적별 KB시세(일반거래가, 상한가, 하한가) 조회
- 네이버 부동산 단지와 KB 단지 매칭
"""

import asyncio
import difflib
import logging
import re
from typing import Any, Dict, List, Optional, Tuple

import httpx

logger = logging.getLogger(__name__)

# ──────────────────────────────────────────
# KB부동산 API 베이스 URL
# kbland.kr 프론트엔드에서 사용하는 내부 API 서버
# ──────────────────────────────────────────
KB_API_BASE = "https://api.kbland.kr"

# KB부동산 내부 API 엔드포인트
# 지역별 단지 목록 (법정동코드 기반)
COMPLEX_LIST_URL = f"{KB_API_BASE}/land-price/price/fastPriceComplexName"
# 단지 간략 정보 (시세 범위 포함)
COMPLEX_BRIF_URL = f"{KB_API_BASE}/land-complex/complex/brif"
# 단지 면적별 타입 정보
COMPLEX_TYPE_URL = f"{KB_API_BASE}/land-complex/complex/typInfo"
# 면적별 KB시세 상세 조회
PRICE_INFO_URL = f"{KB_API_BASE}/land-price/price/BasePrcInfoNew"

# kbland.kr 프론트엔드 Origin / Referer (CORS 및 접근 제어용)
DEFAULT_HEADERS = {
    "User-Agent": (
        "Mozilla/5.0 (Windows NT 10.0; Win64; x64) "
        "AppleWebKit/537.36 (KHTML, like Gecko) "
        "Chrome/120.0.0.0 Safari/537.36"
    ),
    "Accept": "application/json, text/plain, */*",
    "Accept-Language": "ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7",
    "Origin": "https://kbland.kr",
    "Referer": "https://kbland.kr/",
}

# 재시도 설정
MAX_RETRIES = 3
RETRY_BACKOFF_BASE = 2.0  # 지수 백오프 기본 초

# KB 시세 딜레이 (rate limiting)
KB_DELAY_SECONDS = 1.5

# ──────────────────────────────────────────
# 전국 시/군/구 법정동코드 매핑 (kbland.kr용)
# 구-level 코드 (fallback용): 5자리 SIGUNGU_CODE + "00000" = 10자리
# ──────────────────────────────────────────
LAWDCD_MAP: Dict[str, Dict[str, str]] = {
    "서울특별시": {
        "종로구":   "1111000000",
        "중구":     "1114000000",
        "용산구":   "1117000000",
        "성동구":   "1120000000",
        "광진구":   "1121500000",
        "동대문구": "1123000000",
        "중랑구":   "1126000000",
        "성북구":   "1129000000",
        "강북구":   "1130500000",
        "도봉구":   "1132000000",
        "노원구":   "1135000000",
        "은평구":   "1138000000",
        "서대문구": "1141000000",
        "마포구":   "1144000000",
        "양천구":   "1147000000",
        "강서구":   "1150000000",
        "구로구":   "1153000000",
        "금천구":   "1154500000",
        "영등포구": "1156000000",
        "동작구":   "1159000000",
        "관악구":   "1162000000",
        "서초구":   "1165000000",
        "강남구":   "1168000000",
        "송파구":   "1171000000",
        "강동구":   "1174000000",
    },
    "경기도": {
        "수원시":   "4111000000",
        "성남시":   "4113000000",
        "의정부시": "4115000000",
        "안양시":   "4117000000",
        "부천시":   "4119000000",
        "광명시":   "4121000000",
        "평택시":   "4122000000",
        "동두천시": "4125000000",
        "안산시":   "4127000000",
        "고양시":   "4128000000",
        "과천시":   "4129000000",
        "구리시":   "4131000000",
        "남양주시": "4136000000",
        "오산시":   "4137000000",
        "시흥시":   "4139000000",
        "군포시":   "4141000000",
        "의왕시":   "4143000000",
        "하남시":   "4145000000",
        "용인시":   "4146000000",
        "파주시":   "4148000000",
        "이천시":   "4150000000",
        "안성시":   "4155000000",
        "김포시":   "4157000000",
        "화성시":   "4159000000",
        "광주시":   "4161000000",
        "양주시":   "4163000000",
        "포천시":   "4165000000",
        "여주시":   "4167000000",
    },
    "인천광역시": {
        "중구":     "2811000000",
        "동구":     "2814000000",
        "미추홀구": "2817700000",
        "연수구":   "2818500000",
        "남동구":   "2820000000",
        "부평구":   "2823700000",
        "계양구":   "2824500000",
        "서구":     "2826000000",
    },
    "부산광역시": {
        "중구":     "2611000000",
        "서구":     "2614000000",
        "동구":     "2617000000",
        "영도구":   "2620000000",
        "부산진구": "2623000000",
        "동래구":   "2626000000",
        "남구":     "2629000000",
        "북구":     "2632000000",
        "해운대구": "2635000000",
        "사하구":   "2638000000",
        "금정구":   "2641000000",
        "강서구":   "2644000000",
        "연제구":   "2647000000",
        "수영구":   "2650000000",
        "사상구":   "2653000000",
        "기장군":   "2671000000",
    },
    "대구광역시": {
        "중구":   "2711000000",
        "동구":   "2714000000",
        "서구":   "2717000000",
        "남구":   "2720000000",
        "북구":   "2723000000",
        "수성구": "2726000000",
        "달서구": "2729000000",
        "달성군": "2771000000",
    },
    "광주광역시": {
        "동구":   "2911000000",
        "서구":   "2914000000",
        "남구":   "2915500000",
        "북구":   "2917000000",
        "광산구": "2920000000",
    },
    "대전광역시": {
        "동구":   "3011000000",
        "중구":   "3014000000",
        "서구":   "3017000000",
        "유성구": "3020000000",
        "대덕구": "3023000000",
    },
    "세종특별자치시": {
        "세종시": "3611000000",
    },
    "울산광역시": {
        "중구":   "3111000000",
        "남구":   "3114000000",
        "동구":   "3117000000",
        "북구":   "3120000000",
        "울주군": "3171000000",
    },
}

# ──────────────────────────────────────────
# 동-level 법정동코드 매핑
# KB API(fastPriceComplexName)는 동-level 코드가 필요함
# ──────────────────────────────────────────
DONG_LAWDCD_MAP: Dict[str, Dict[str, Dict[str, str]]] = {
    "서울특별시": {
        "강남구": {
            "역삼동": "1168010100",
            "개포동": "1168010300",
            "청담동": "1168010400",
            "삼성동": "1168010500",
            "대치동": "1168010600",
            "신사동": "1168010700",
            "논현동": "1168010800",
            "압구정동": "1168011000",
            "세곡동": "1168011100",
            "자곡동": "1168011200",
            "율현동": "1168011300",
            "일원동": "1168011400",
            "수서동": "1168011500",
            "도곡동": "1168011800",
        },
        "서초구": {
            "방배동": "1165010100",
            "양재동": "1165010200",
            "우면동": "1165010300",
            "잠원동": "1165010600",
            "반포동": "1165010700",
            "서초동": "1165010800",
            "내곡동": "1165010900",
            "신원동": "1165011100",
        },
        "송파구": {
            "잠실동": "1171010100",
            "신천동": "1171010200",
            "풍납동": "1171010300",
            "송파동": "1171010400",
            "석촌동": "1171010500",
            "삼전동": "1171010600",
            "가락동": "1171010700",
            "문정동": "1171010800",
            "장지동": "1171010900",
            "방이동": "1171011100",
            "오금동": "1171011200",
            "거여동": "1171011300",
            "마천동": "1171011400",
        },
        # ── Sprint 11: 동-level 세분화 (19개 구 추가) ──
        "성동구": {
            "상왕십리동": "1120010100",
            "하왕십리동": "1120010200",
            "홍익동": "1120010300",
            "도선동": "1120010400",
            "마장동": "1120010500",
            "사근동": "1120010600",
            "행당동": "1120010700",
            "응봉동": "1120010800",
            "금호동1가": "1120010900",
            "금호동2가": "1120011000",
            "금호동3가": "1120011100",
            "금호동4가": "1120011200",
            "옥수동": "1120011300",
            "성수동1가": "1120011400",
            "성수동2가": "1120011500",
            "송정동": "1120011800",
            "용답동": "1120012200",
        },
        "광진구": {
            "중곡동": "1121510100",
            "능동": "1121510200",
            "구의동": "1121510300",
            "광장동": "1121510400",
            "자양동": "1121510500",
            "화양동": "1121510700",
            "군자동": "1121510900",
        },
        "동대문구": {
            "신설동": "1123010100",
            "용두동": "1123010200",
            "제기동": "1123010300",
            "전농동": "1123010400",
            "답십리동": "1123010500",
            "장안동": "1123010600",
            "청량리동": "1123010700",
            "회기동": "1123010800",
            "휘경동": "1123010900",
            "이문동": "1123011000",
        },
        "중랑구": {
            "면목동": "1126010100",
            "상봉동": "1126010200",
            "중화동": "1126010300",
            "묵동": "1126010400",
            "망우동": "1126010500",
            "신내동": "1126010600",
        },
        "성북구": {
            "성북동": "1129010100",
            "성북동1가": "1129010200",
            "돈암동": "1129010300",
            "동소문동1가": "1129010400",
            "동소문동2가": "1129010500",
            "동소문동3가": "1129010600",
            "동소문동4가": "1129010700",
            "동소문동5가": "1129010800",
            "동소문동6가": "1129010900",
            "동소문동7가": "1129011000",
            "삼선동1가": "1129011100",
            "삼선동2가": "1129011200",
            "삼선동3가": "1129011300",
            "삼선동4가": "1129011400",
            "삼선동5가": "1129011500",
            "동선동1가": "1129011600",
            "동선동2가": "1129011700",
            "동선동3가": "1129011800",
            "동선동4가": "1129011900",
            "동선동5가": "1129012000",
            "안암동1가": "1129012100",
            "안암동2가": "1129012200",
            "안암동3가": "1129012300",
            "안암동4가": "1129012400",
            "안암동5가": "1129012500",
            "보문동4가": "1129012600",
            "보문동5가": "1129012700",
            "보문동6가": "1129012800",
            "보문동7가": "1129012900",
            "보문동1가": "1129013000",
            "보문동2가": "1129013100",
            "보문동3가": "1129013200",
            "정릉동": "1129013300",
            "길음동": "1129013400",
            "종암동": "1129013500",
            "하월곡동": "1129013600",
            "상월곡동": "1129013700",
            "장위동": "1129013800",
            "석관동": "1129013900",
        },
        "강북구": {
            "미아동": "1130510100",
            "번동": "1130510200",
            "수유동": "1130510300",
            "우이동": "1130510400",
        },
        "도봉구": {
            "쌍문동": "1132010500",
            "방학동": "1132010600",
            "창동": "1132010700",
            "도봉동": "1132010800",
        },
        "노원구": {
            "월계동": "1135010200",
            "공릉동": "1135010300",
            "하계동": "1135010400",
            "상계동": "1135010500",
            "중계동": "1135010600",
        },
        "은평구": {
            "수색동": "1138010100",
            "녹번동": "1138010200",
            "불광동": "1138010300",
            "갈현동": "1138010400",
            "구산동": "1138010500",
            "대조동": "1138010600",
            "응암동": "1138010700",
            "역촌동": "1138010800",
            "신사동": "1138010900",
            "증산동": "1138011000",
            "진관동": "1138011400",
        },
        "서대문구": {
            "충정로2가": "1141010100",
            "충정로3가": "1141010200",
            "합동": "1141010300",
            "미근동": "1141010400",
            "냉천동": "1141010500",
            "천연동": "1141010600",
            "옥천동": "1141010700",
            "영천동": "1141010800",
            "현저동": "1141010900",
            "북아현동": "1141011000",
            "홍제동": "1141011100",
            "대현동": "1141011200",
            "대신동": "1141011300",
            "신촌동": "1141011400",
            "봉원동": "1141011500",
            "창천동": "1141011600",
            "연희동": "1141011700",
            "홍은동": "1141011800",
            "북가좌동": "1141011900",
            "남가좌동": "1141012000",
        },
        "마포구": {
            "아현동": "1144010100",
            "공덕동": "1144010200",
            "신공덕동": "1144010300",
            "도화동": "1144010400",
            "용강동": "1144010500",
            "토정동": "1144010600",
            "마포동": "1144010700",
            "대흥동": "1144010800",
            "염리동": "1144010900",
            "노고산동": "1144011000",
            "신수동": "1144011100",
            "현석동": "1144011200",
            "구수동": "1144011300",
            "창전동": "1144011400",
            "상수동": "1144011500",
            "하중동": "1144011600",
            "신정동": "1144011700",
            "당인동": "1144011800",
            "서교동": "1144012000",
            "동교동": "1144012100",
            "합정동": "1144012200",
            "망원동": "1144012300",
            "연남동": "1144012400",
            "성산동": "1144012500",
            "중동": "1144012600",
            "상암동": "1144012700",
        },
        "양천구": {
            "신정동": "1147010100",
            "목동": "1147010200",
            "신월동": "1147010300",
        },
        "강서구": {
            "염창동": "1150010100",
            "등촌동": "1150010200",
            "화곡동": "1150010300",
            "가양동": "1150010400",
            "마곡동": "1150010500",
            "내발산동": "1150010600",
            "외발산동": "1150010700",
            "공항동": "1150010800",
            "방화동": "1150010900",
            "개화동": "1150011000",
            "과해동": "1150011100",
            "오곡동": "1150011200",
            "오쇠동": "1150011300",
        },
        "구로구": {
            "신도림동": "1153010100",
            "구로동": "1153010200",
            "가리봉동": "1153010300",
            "고척동": "1153010600",
            "개봉동": "1153010700",
            "오류동": "1153010800",
            "궁동": "1153010900",
            "온수동": "1153011000",
            "천왕동": "1153011100",
            "항동": "1153011200",
        },
        "금천구": {
            "가산동": "1154510100",
            "독산동": "1154510200",
            "시흥동": "1154510300",
        },
        "영등포구": {
            "영등포동": "1156010100",
            "영등포동1가": "1156010200",
            "영등포동2가": "1156010300",
            "영등포동3가": "1156010400",
            "영등포동4가": "1156010500",
            "영등포동5가": "1156010600",
            "영등포동6가": "1156010700",
            "영등포동7가": "1156010800",
            "영등포동8가": "1156010900",
            "여의도동": "1156011000",
            "당산동1가": "1156011100",
            "당산동2가": "1156011200",
            "당산동3가": "1156011300",
            "당산동4가": "1156011400",
            "당산동5가": "1156011500",
            "당산동6가": "1156011600",
            "당산동": "1156011700",
            "도림동": "1156011800",
            "문래동1가": "1156011900",
            "문래동2가": "1156012000",
            "문래동3가": "1156012100",
            "문래동4가": "1156012200",
            "문래동5가": "1156012300",
            "문래동6가": "1156012400",
            "양평동1가": "1156012500",
            "양평동2가": "1156012600",
            "양평동3가": "1156012700",
            "양평동4가": "1156012800",
            "양평동5가": "1156012900",
            "양평동6가": "1156013000",
            "양화동": "1156013100",
            "신길동": "1156013200",
            "대림동": "1156013300",
            "양평동": "1156013400",
        },
        "동작구": {
            "노량진동": "1159010100",
            "상도동": "1159010200",
            "상도1동": "1159010300",
            "본동": "1159010400",
            "흑석동": "1159010500",
            "동작동": "1159010600",
            "사당동": "1159010700",
            "대방동": "1159010800",
            "신대방동": "1159010900",
        },
        "관악구": {
            "봉천동": "1162010100",
            "신림동": "1162010200",
            "남현동": "1162010300",
        },
        "강동구": {
            "명일동": "1174010100",
            "고덕동": "1174010200",
            "상일동": "1174010300",
            "길동": "1174010500",
            "둔촌동": "1174010600",
            "암사동": "1174010700",
            "성내동": "1174010800",
            "천호동": "1174010900",
            "강일동": "1174011000",
        },
        # ── Sprint 10: 동-level 세분화 (기존 구-level 폴백으로 매칭 실패 86/74/56건) ──
        "종로구": {
            "청운동": "1111010100",
            "신교동": "1111010200",
            "궁정동": "1111010300",
            "효자동": "1111010400",
            "창성동": "1111010500",
            "통의동": "1111010600",
            "적선동": "1111010700",
            "통인동": "1111010800",
            "누상동": "1111010900",
            "누하동": "1111011000",
            "옥인동": "1111011100",
            "체부동": "1111011200",
            "필운동": "1111011300",
            "내자동": "1111011400",
            "사직동": "1111011500",
            "도렴동": "1111011600",
            "당주동": "1111011700",
            "내수동": "1111011800",
            "세종로": "1111011900",
            "신문로1가": "1111012000",
            "신문로2가": "1111012100",
            "청진동": "1111012200",
            "서린동": "1111012300",
            "수송동": "1111012400",
            "중학동": "1111012500",
            "종로1가": "1111012600",
            "공평동": "1111012700",
            "관훈동": "1111012800",
            "견지동": "1111012900",
            "와룡동": "1111013000",
            "권농동": "1111013100",
            "운니동": "1111013200",
            "익선동": "1111013300",
            "경운동": "1111013400",
            "관철동": "1111013500",
            "인사동": "1111013600",
            "낙원동": "1111013700",
            "종로2가": "1111013800",
            "팔판동": "1111013900",
            "삼청동": "1111014000",
            "안국동": "1111014100",
            "소격동": "1111014200",
            "화동": "1111014300",
            "사간동": "1111014400",
            "송현동": "1111014500",
            "가회동": "1111014600",
            "재동": "1111014700",
            "계동": "1111014800",
            "원서동": "1111014900",
            "훈정동": "1111015000",
            "묘동": "1111015100",
            "봉익동": "1111015200",
            "돈의동": "1111015300",
            "장사동": "1111015400",
            "관수동": "1111015500",
            "종로3가": "1111015600",
            "인의동": "1111015700",
            "예지동": "1111015800",
            "원남동": "1111015900",
            "연지동": "1111016000",
            "종로4가": "1111016100",
            "효제동": "1111016200",
            "종로5가": "1111016300",
            "종로6가": "1111016400",
            "이화동": "1111016500",
            "연건동": "1111016600",
            "충신동": "1111016700",
            "동숭동": "1111016800",
            "혜화동": "1111016900",
            "명륜1가": "1111017000",
            "명륜2가": "1111017100",
            "명륜4가": "1111017200",
            "명륜3가": "1111017300",
            "창신동": "1111017400",
            "숭인동": "1111017500",
            "교남동": "1111017600",
            "평동": "1111017700",
            "송월동": "1111017800",
            "홍파동": "1111017900",
            "교북동": "1111018000",
            "행촌동": "1111018100",
            "구기동": "1111018200",
            "평창동": "1111018300",
            "부암동": "1111018400",
            "홍지동": "1111018500",
            "신영동": "1111018600",
            "무악동": "1111018700",
        },
        "중구": {
            "무교동": "1114010100",
            "다동": "1114010200",
            "태평로1가": "1114010300",
            "을지로1가": "1114010400",
            "을지로2가": "1114010500",
            "남대문로1가": "1114010600",
            "삼각동": "1114010700",
            "수하동": "1114010800",
            "장교동": "1114010900",
            "수표동": "1114011000",
            "소공동": "1114011100",
            "남창동": "1114011200",
            "북창동": "1114011300",
            "태평로2가": "1114011400",
            "남대문로2가": "1114011500",
            "남대문로3가": "1114011600",
            "남대문로4가": "1114011700",
            "남대문로5가": "1114011800",
            "봉래동1가": "1114011900",
            "봉래동2가": "1114012000",
            "회현동1가": "1114012100",
            "회현동2가": "1114012200",
            "회현동3가": "1114012300",
            "충무로1가": "1114012400",
            "충무로2가": "1114012500",
            "명동1가": "1114012600",
            "명동2가": "1114012700",
            "남산동1가": "1114012800",
            "남산동2가": "1114012900",
            "남산동3가": "1114013000",
            "저동1가": "1114013100",
            "충무로4가": "1114013200",
            "충무로5가": "1114013300",
            "인현동2가": "1114013400",
            "예관동": "1114013500",
            "묵정동": "1114013600",
            "필동1가": "1114013700",
            "필동2가": "1114013800",
            "필동3가": "1114013900",
            "남학동": "1114014000",
            "주자동": "1114014100",
            "예장동": "1114014200",
            "장충동1가": "1114014300",
            "장충동2가": "1114014400",
            "광희동1가": "1114014500",
            "광희동2가": "1114014600",
            "쌍림동": "1114014700",
            "을지로6가": "1114014800",
            "을지로7가": "1114014900",
            "을지로4가": "1114015000",
            "을지로5가": "1114015100",
            "주교동": "1114015200",
            "방산동": "1114015300",
            "오장동": "1114015400",
            "을지로3가": "1114015500",
            "입정동": "1114015600",
            "산림동": "1114015700",
            "충무로3가": "1114015800",
            "초동": "1114015900",
            "인현동1가": "1114016000",
            "저동2가": "1114016100",
            "신당동": "1114016200",
            "흥인동": "1114016300",
            "무학동": "1114016400",
            "황학동": "1114016500",
            "서소문동": "1114016600",
            "정동": "1114016700",
            "순화동": "1114016800",
            "의주로1가": "1114016900",
            "충정로1가": "1114017000",
            "중림동": "1114017100",
            "의주로2가": "1114017200",
            "만리동1가": "1114017300",
            "만리동2가": "1114017400",
        },
        "용산구": {
            "후암동": "1117010100",
            "용산동2가": "1117010200",
            "용산동4가": "1117010300",
            "갈월동": "1117010400",
            "남영동": "1117010500",
            "용산동1가": "1117010600",
            "동자동": "1117010700",
            "서계동": "1117010800",
            "청파동1가": "1117010900",
            "청파동2가": "1117011000",
            "청파동3가": "1117011100",
            "원효로1가": "1117011200",
            "원효로2가": "1117011300",
            "신창동": "1117011400",
            "산천동": "1117011500",
            "청암동": "1117011600",
            "원효로3가": "1117011700",
            "원효로4가": "1117011800",
            "효창동": "1117011900",
            "도원동": "1117012000",
            "용문동": "1117012100",
            "문배동": "1117012200",
            "신계동": "1117012300",
            "한강로1가": "1117012400",
            "한강로2가": "1117012500",
            "용산동3가": "1117012600",
            "용산동5가": "1117012700",
            "한강로3가": "1117012800",
            "이촌동": "1117012900",
            "이태원동": "1117013000",
            "한남동": "1117013100",
            "동빙고동": "1117013200",
            "서빙고동": "1117013300",
            "주성동": "1117013400",
            "용산동6가": "1117013500",
            "보광동": "1117013600",
        },
    },
    "경기도": {
        "수원시": {
            "영화동":    "4111100100",
            "정자동":    "4111100200",
            "조원동":    "4111100300",
            "파장동":    "4111100400",
            "율전동":    "4111100500",
            "천천동":    "4111100600",
            "연무동":    "4111100800",
            "세류동":    "4111300100",
            "평동":      "4111300200",
            "고색동":    "4111300300",
            "오목천동":  "4111300400",
            "호매실동":  "4111300600",
            "권선동":    "4111301000",
            "금곡동":    "4111301100",
            "입북동":    "4111301200",
            "서둔동":    "4111301400",
            "구운동":    "4111301500",
            "매산로1가": "4111500100",
            "매산로2가": "4111500200",
            "매산로3가": "4111500300",
            "고등동":    "4111500400",
            "화서동":    "4111500500",
            "지동":      "4111500600",
            "우만동":    "4111500700",
            "인계동":    "4111500800",
            "남창동":    "4111500900",
            "중동":      "4111501000",
            "구천동":    "4111501100",
            "교동":      "4111501200",
            "북수동":    "4111501300",
            "영동":      "4111501400",
            "신풍동":    "4111501500",
            "팔달로1가": "4111501600",
            "팔달로2가": "4111501700",
            "팔달로3가": "4111501800",
            "장안동":    "4111501900",
            "매교동":    "4111502000",
            "매향동":    "4111502100",
            "남수동":    "4111502200",
            "사직동":    "4111502400",
            "매탄동":    "4111700100",
            "원천동":    "4111700200",
            "영통동":    "4111700300",
            "태장동":    "4111700400",
            "광교동":    "4111700500",
            "하동":      "4111700600",
            "이의동":    "4111700700",
        },
        "성남시": {
            "수진동":    "4113100100",
            "신흥동":    "4113100200",
            "태평동":    "4113100300",
            "성남동":    "4113100400",
            "중앙동":    "4113100500",
            "금광동":    "4113100600",
            "은행동":    "4113100700",
            "복정동":    "4113100800",
            "창곡동":    "4113100900",
            "시흥동":    "4113101000",
            "단대동":    "4113101100",
            "산성동":    "4113101200",
            "양지동":    "4113101400",
            "위례동":    "4113101500",
            "여수동":    "4113300200",
            "상대원동":  "4113300300",
            "하대원동":  "4113300400",
            "도촌동":    "4113300500",
            "분당동":    "4113511000",
            "수내동":    "4113511100",
            "정자동":    "4113511200",
            "야탑동":    "4113511500",
            "이매동":    "4113511600",
            "서현동":    "4113511700",
            "판교동":    "4113511800",
            "삼평동":    "4113512000",
            "백현동":    "4113512100",
            "운중동":    "4113512200",
            "하산운동":  "4113512300",
            "대장동":    "4113512400",
            "구미동":    "4113514000",
        },
        "의정부시": {
            "의정부동":  "4115000100",
            "호원동":    "4115000200",
            "장암동":    "4115000300",
            "신곡동":    "4115000400",
            "용현동":    "4115000500",
            "민락동":    "4115000600",
            "낙양동":    "4115000700",
            "가능동":    "4115000900",
            "녹양동":    "4115001000",
            "고산동":    "4115001100",
            "자일동":    "4115001200",
            "산곡동":    "4115001400",
            "발곡동":    "4115001500",
            "금오동": "4115010900",
        },
        "안양시": {
            "안양동":    "4117100100",
            "석수동":    "4117100200",
            "박달동":    "4117100300",
            "비산동":    "4117300100",
            "관양동":    "4117300200",
            "귀인동":    "4117300300",
            "호계동":    "4117300400",
            "평촌동":    "4117300500",
            "부림동":    "4117300600",
            "달안동":    "4117300700",
        },
        "부천시": {
            "심곡동":    "4119000100",
            "원미동":    "4119000200",
            "춘의동":    "4119000300",
            "도당동":    "4119000400",
            "약대동":    "4119000500",
            "중동":      "4119000600",
            "상동":      "4119000700",
            "심곡본동":  "4119000800",
            "성곡동":    "4119001000",
            "소사동":    "4119001200",
            "괴안동":    "4119001300",
            "역곡동":    "4119001400",
            "옥길동":    "4119001500",
            "오정동":    "4119001700",
            "내동":      "4119001800",
            "삼정동":    "4119001900",
            "여월동":    "4119002000",
            "작동":      "4119002100",
            "고강동":    "4119002200",
            "원종동":    "4119002300",
            "대장동":    "4119002400",
            "송내동":    "4119002600",
            "범박동":    "4119002800",
        },
        "광명시": {
            "광명동":    "4121000100",
            "철산동":    "4121000200",
            "하안동":    "4121000300",
            "소하동":    "4121000400",
            "노온사동":  "4121000500",
            "가학동":    "4121000600",
            "옥길동":    "4121000700",
            "일직동":    "4121000800",
        },
        "평택시": {
            "평택동":    "4122000100",
            "서정동":    "4122000200",
            "합정동":    "4122000300",
            "통복동":    "4122000400",
            "중앙동":    "4122000500",
            "세교동":    "4122000600",
            "신장동":    "4122000700",
            "동삭동":    "4122000800",
            "지산동":    "4122000900",
            "용이동":    "4122001000",
            "이충동":    "4122001100",
            "장당동":    "4122001200",
            "고덕동":    "4122001300",
            "소사동":    "4122001400",
            "고덕면 궁리": "4122033026",
            "군문동": "4122011500",
            "독곡동": "4122011100",
            "비전동": "4122011800",
            "안중읍 금곡리": "4122025323",
            "안중읍 송담리": "4122025329",
            "안중읍 안중리": "4122025321",
            "안중읍 학현리": "4122025322",
            "안중읍 현화리": "4122025330",
            "오성면 숙성리": "4122034021",
            "장안동": "4122010800",
            "죽백동": "4122012700",
            "지제동": "4122012100",
            "진위면 가곡리": "4122031029",
            "진위면 갈곶리": "4122031027",
            "진위면 견산리": "4122031030",
            "진위면 봉남리": "4122031021",
            "청북읍 옥길리": "4122025924",
            "칠원동": "4122010500",
            "팽성읍 객사리": "4122025021",
            "팽성읍 송화리": "4122025045",
            "팽성읍 안정리": "4122025041",
            "팽성읍 평궁리": "4122025025",
            "포승읍 내기리": "4122025621",
            "포승읍 도곡리": "4122025622",
            "포승읍 만호리": "4122025624",
            "포승읍 방림리": "4122025627",
            "포승읍 석정리": "4122025628",
            "현덕면 권관리": "4122037030",
            "현덕면 인광리": "4122037025",
        },
        "안산시": {
            "사동":      "4127100100",
            "본오동":    "4127100200",
            "팔곡일동":  "4127100300",
            "팔곡이동":  "4127100400",
            "건건동":    "4127100500",
            "수암동":    "4127100600",
            "부곡동":    "4127100700",
            "월피동":    "4127100800",
            "성포동":    "4127100900",
            "고잔동":    "4127300100",
            "원곡동":    "4127300200",
            "초지동":    "4127300300",
            "신길동":    "4127300400",
            "와동":      "4127300500",
            "성곡동":    "4127300600",
            "선부동":    "4127300700",
            "대부동동":  "4127300800",
            "대부남동":  "4127300900",
            "대부북동":  "4127301000",
            "풍도동":    "4127301100",
        },
        "고양시": {
            "주교동":    "4128100100",
            "원당동":    "4128100200",
            "성사동":    "4128100300",
            "화정동":    "4128100400",
            "대장동":    "4128100500",
            "신원동":    "4128100600",
            "벽제동":    "4128100700",
            "고양동":    "4128100800",
            "지축동":    "4128100900",
            "효자동":    "4128101000",
            "행주내동":  "4128101100",
            "행주외동":  "4128101200",
            "관산동":    "4128101300",
            "토당동":    "4128101400",
            "능곡동":    "4128101500",
            "행신동":    "4128101600",
            "신평동":    "4128101700",
            "용두동":    "4128101800",
            "향동동":    "4128102000",
            "백석동":    "4128500100",
            "중산동":    "4128500200",
            "정발산동":  "4128500300",
            "장항동":    "4128500400",
            "마두동":    "4128500500",
            "풍동":      "4128500600",
            "산황동":    "4128500700",
            "설문동":    "4128500800",
            "지영동":    "4128500900",
            "식사동":    "4128501000",
            "문봉동":    "4128501100",
            "성석동":    "4128501200",
            "일산동":    "4128700100",
            "주엽동":    "4128700200",
            "탄현동":    "4128700300",
            "덕이동":    "4128700400",
            "가좌동":    "4128700500",
            "구산동":    "4128700600",
            "대화동":    "4128700700",
            "법곳동":    "4128700800",
        },
        "과천시": {
            "과천동":    "4129000100",
            "관문동":    "4129000200",
            "원문동":    "4129000300",
            "별양동":    "4129000400",
            "부림동":    "4129000500",
            "갈현동":    "4129000600",
            "주암동":    "4129000700",
            "중앙동": "4129010700",
        },
        "구리시": {
            "인창동":    "4131000100",
            "교문동":    "4131000200",
            "수택동":    "4131000300",
            "갈매동":    "4131000400",
            "아천동":    "4131000500",
            "사노동":    "4131000600",
            "토평동":    "4131000700",
        },
        "남양주시": {
            "별내동":    "4136000100",
            "다산동":    "4136000200",
            "호평동":    "4136000300",
            "평내동":    "4136000400",
            "금곡동":    "4136000500",
            "일패동":    "4136000600",
            "이패동":    "4136000700",
            "삼패동":    "4136000800",
            "가운동":    "4136000900",
            "수석동":    "4136001000",
            "지금동":    "4136001100",
            "도농동":    "4136001200",
            "별내면 청학리": "4136031021",
            "오남읍 양지리": "4136026221",
            "오남읍 오남리": "4136026223",
            "와부읍 덕소리": "4136025021",
            "와부읍 도곡리": "4136025022",
            "진건읍 사능리": "4136025921",
            "진건읍 신월리": "4136025924",
            "진건읍 용정리": "4136025925",
            "진건읍 진관리": "4136025923",
            "진접읍 금곡리": "4136025328",
            "진접읍 내각리": "4136025322",
            "진접읍 부평리": "4136025325",
            "진접읍 연평리": "4136025324",
            "진접읍 장현리": "4136025321",
            "진접읍 진벌리": "4136025327",
            "진접읍 팔야리": "4136025326",
            "퇴계원읍 퇴계원리": "4136026521",
            "화도읍 가곡리": "4136025623",
            "화도읍 녹촌리": "4136025629",
            "화도읍 답내리": "4136025626",
            "화도읍 마석우리": "4136025621",
            "화도읍 묵현리": "4136025622",
            "화도읍 월산리": "4136025627",
            "화도읍 차산리": "4136025630",
            "화도읍 창현리": "4136025628",
        },
        "오산시": {
            "오산동":    "4137000100",
            "갈곶동":    "4137000200",
            "수청동":    "4137000300",
            "원동":      "4137000400",
            "청학동":    "4137000500",
            "부산동":    "4137000600",
            "외삼미동":  "4137000700",
            "내삼미동":  "4137000800",
            "금암동":    "4137000900",
            "은계동":    "4137001000",
            "양산동":    "4137001100",
            "세마동":    "4137001200",
            "초평동":    "4137001300",
            "가수동": "4137012100",
            "고현동": "4137012200",
            "궐동": "4137010400",
            "누읍동": "4137012000",
            "서동": "4137011600",
            "세교동": "4137011300",
            "지곶동": "4137011400",
            "청호동": "4137012300",
        },
        "시흥시": {
            "신천동":    "4139000100",
            "포동":      "4139000200",
            "미산동":    "4139000300",
            "은행동":    "4139000400",
            "방산동":    "4139000500",
            "금이동":    "4139000600",
            "과림동":    "4139000700",
            "광석동":    "4139000800",
            "논곡동":    "4139000900",
            "하중동":    "4139001000",
            "산현동":    "4139001100",
            "능곡동":    "4139001200",
            "조남동":    "4139001300",
            "매화동":    "4139001400",
            "목감동":    "4139001500",
            "군자동":    "4139001600",
            "장곡동":    "4139001700",
            "정왕동":    "4139001800",
            "월곶동":    "4139001900",
            "거모동":    "4139002000",
            "배곧동":    "4139002100",
            "대야동": "4139010100",
            "도창동": "4139010900",
            "장현동": "4139012900",
            "죽율동": "4139013300",
            "하상동": "4139012000",
        },
        "군포시": {
            "산본동":    "4141000100",
            "금정동":    "4141000200",
            "속달동":    "4141000300",
            "대야미동":  "4141000400",
            "부곡동":    "4141000500",
            "둔대동":    "4141000600",
            "궁내동":    "4141000700",
            "당동":      "4141000800",
            "군포동":    "4141000900",
            "당정동": "4141010200",
            "도마교동": "4141010900",
        },
        "의왕시": {
            "부곡동":    "4143000100",
            "고천동":    "4143000200",
            "오전동":    "4143000300",
            "내손동":    "4143000400",
            "청계동":    "4143000500",
            "학의동":    "4143000600",
            "포일동":    "4143000700",
            "왕곡동":    "4143000800",
            "삼동": "4143010300",
        },
        "하남시": {
            "창우동":    "4145000100",
            "천현동":    "4145000200",
            "교산동":    "4145000300",
            "풍산동":    "4145000400",
            "춘궁동":    "4145000500",
            "하사창동":  "4145000600",
            "상사창동":  "4145000700",
            "감북동":    "4145000800",
            "감일동":    "4145000900",
            "감이동":    "4145001000",
            "초이동":    "4145001100",
            "초일동":    "4145001200",
            "학암동":    "4145001300",
            "미사동":    "4145001400",
            "망월동":    "4145001500",
            "신장동":    "4145001600",
            "덕풍동":    "4145001700",
            "선동": "4145011200",
        },
        "용인시": {
            "김량장동":  "4146100100",
            "역북동":    "4146100200",
            "삼가동":    "4146100300",
            "유방동":    "4146100400",
            "고림동":    "4146100500",
            "마평동":    "4146100600",
            "운학동":    "4146100700",
            "호동":      "4146100800",
            "해곡동":    "4146100900",
            "신갈동":    "4146300100",
            "구갈동":    "4146300200",
            "상갈동":    "4146300300",
            "하갈동":    "4146300400",
            "보라동":    "4146300500",
            "지곡동":    "4146300600",
            "공세동":    "4146300700",
            "고매동":    "4146300800",
            "농서동":    "4146300900",
            "서천동":    "4146301000",
            "영덕동":    "4146301100",
            "언남동":    "4146301200",
            "청덕동":    "4146301300",
            "동백동":    "4146301400",
            "중동":      "4146301500",
            "풍덕천동":  "4146500100",
            "죽전동":    "4146500200",
            "동천동":    "4146500300",
            "고기동":    "4146500400",
            "신봉동":    "4146500500",
            "성복동":    "4146500600",
            "상현동":    "4146500700",
            "광교동":    "4146500800",
        },
        "파주시": {
            "금촌동":    "4148000100",
            "아동동":    "4148000200",
            "야동동":    "4148000300",
            "맥금동":    "4148000400",
            "검산동":    "4148000500",
            "금릉동":    "4148000600",
            "교하동":    "4148000700",
            "목동동":    "4148000800",
            "야당동":    "4148000900",
            "와동동":    "4148001000",
            "운정동":    "4148001100",
            "다율동":    "4148001200",
            "당하동":    "4148001300",
            "식사동":    "4148001400",
            "봉암동":    "4148001500",
            "오도동":    "4148001600",
            "광탄면 신산리": "4148035027",
            "동패동": "4148011300",
            "문발동": "4148011500",
            "문산읍 당동리": "4148025022",
            "문산읍 문산리": "4148025021",
            "문산읍 선유리": "4148025023",
            "법원읍 가야리": "4148025623",
            "법원읍 법원리": "4148025622",
            "적성면 마지리": "4148037035",
            "조리읍 대원리": "4148026227",
            "조리읍 봉일천리": "4148026221",
            "파주읍 연풍리": "4148025327",
            "파주읍 파주리": "4148025326",
        },
        "이천시": {
            "창전동":    "4150000100",
            "중리동":    "4150000200",
            "관고동":    "4150000300",
            "증일동":    "4150000400",
            "증포동":    "4150000500",
            "안흥동":    "4150000600",
            "송정동":    "4150000700",
            "진리동":    "4150000800",
            "율현동":    "4150000900",
            "갈산동": "4150010800",
            "고담동": "4150011400",
            "대월면 사동리": "4150035026",
            "대월면 초지리": "4150035025",
            "마장면 오천리": "4150034021",
            "백사면 모전리": "4150032026",
            "백사면 조읍리": "4150032028",
            "부발읍 가산리": "4150025333",
            "부발읍 마암리": "4150025326",
            "부발읍 무촌리": "4150025321",
            "부발읍 신원리": "4150025323",
            "부발읍 신하리": "4150025328",
            "부발읍 아미리": "4150025330",
            "부발읍 응암리": "4150025334",
            "사음동": "4150011100",
            "신둔면 도봉리": "4150031025",
            "신둔면 수광리": "4150031021",
            "신둔면 수하리": "4150031027",
            "장호원읍 노탑리": "4150025033",
            "장호원읍 장호원리": "4150025021",
            "장호원읍 진암리": "4150025023",
            "호법면 유산리": "4150033021",
        },
        "안성시": {
            "봉남동":    "4155000100",
            "낙원동":    "4155000200",
            "숭인동":    "4155000300",
            "옥천동":    "4155000400",
            "창전동":    "4155000500",
            "대천동":    "4155000600",
            "계동":      "4155000700",
            "인지동":    "4155000800",
            "당왕동":    "4155000900",
            "신흥동":    "4155001000",
            "도기동":    "4155001100",
            "가사동": "4155012600",
            "공도읍 마정리": "4155025030",
            "공도읍 만정리": "4155025029",
            "공도읍 승두리": "4155025026",
            "공도읍 양기리": "4155025021",
            "공도읍 용두리": "4155025025",
            "공도읍 진사리": "4155025031",
            "금광면 신양복리": "4155032034",
            "금산동": "4155011400",
            "금석동": "4155012000",
            "대덕면 건지리": "4155035027",
            "대덕면 내리": "4155035028",
            "대덕면 신령리": "4155035031",
            "대덕면 진현리": "4155035026",
            "미양면 보체리": "4155034033",
            "미양면 양변리": "4155034038",
            "보개면 기좌리": "4155031022",
            "봉산동": "4155010100",
            "석정동": "4155011800",
            "신소현동": "4155012900",
            "아양동": "4155011900",
            "옥산동": "4155012200",
            "원곡면 반제리": "4155038027",
            "원곡면 외가천리": "4155038026",
            "일죽면 송천리": "4155039028",
            "죽산면 장원리": "4155040023",
            "죽산면 죽산리": "4155040021",
            "중리동": "4155013300",
        },
        "김포시": {
            "북변동":    "4157000100",
            "걸포동":    "4157000200",
            "사우동":    "4157000300",
            "풍무동":    "4157000400",
            "장기동":    "4157000500",
            "운양동":    "4157000600",
            "마산동":    "4157000700",
            "감정동":    "4157000800",
            "구래동":    "4157000900",
            "고촌읍 신곡리": "4157025324",
            "고촌읍 태리": "4157025323",
            "고촌읍 향산리": "4157025321",
            "양촌읍 양곡리": "4157025621",
            "양촌읍 학운리": "4157025626",
            "통진읍 도사리": "4157025021",
            "통진읍 마송리": "4157025022",
            "통진읍 서암리": "4157025023",
            "하성면 마곡리": "4157036021",
        },
        "화성시": {
            "진안동":    "4159000100",
            "병점동":    "4159000200",
            "반월동":    "4159000300",
            "기산동":    "4159000400",
            "화산동":    "4159000500",
            "안녕동":    "4159000600",
            "반정동":    "4159000700",
            "황계동":    "4159000800",
            "기배동":    "4159000900",
            "능동":      "4159001000",
            "청계동":    "4159001100",
            "영천동":    "4159001200",
            "오산동":    "4159001300",
            "석우동":    "4159001400",
            "동탄동":    "4159001500",
            "방교동":    "4159001600",
            "목동":      "4159001700",
            "금곡동":    "4159001800",
            "신동":      "4159001900",
            "중동":      "4159002000",
            "장지동":    "4159002200",
            "영통동":    "4159002300",
        },
        "광주시": {
            "경안동":    "4161000100",
            "탄벌동":    "4161000200",
            "목현동":    "4161000300",
            "송정동":    "4161000400",
            "태전동":    "4161000500",
            "쌍령동":    "4161000600",
            "고산동": "4161011400",
            "곤지암읍 곤지암리": "4161025921",
            "곤지암읍 삼리": "4161025936",
            "능평동": "4161011600",
            "도척면 진우리": "4161033028",
            "매산동": "4161011900",
            "문형동": "4161011700",
            "삼동": "4161010700",
            "신현동": "4161011500",
            "양벌동": "4161012000",
            "역동": "4161011200",
            "장지동": "4161011100",
            "초월읍 대쌍령리": "4161025321",
            "초월읍 도평리": "4161025332",
            "초월읍 산이리": "4161025323",
            "초월읍 쌍동리": "4161025322",
            "초월읍 용수리": "4161025327",
            "초월읍 지월리": "4161025329",
            "추자동": "4161011800",
            "회덕동": "4161010400",
        },
        "양주시": {
            "유양동":    "4163000100",
            "삼숭동":    "4163000200",
            "광사동":    "4163000300",
            "회암동":    "4163000400",
            "고암동":    "4163000500",
            "남방동":    "4163000600",
            "마전동":    "4163000700",
            "율정동":    "4163000800",
            "옥정동":    "4163000900",
            "덕계동":    "4163001000",
            "회정동":    "4163001100",
            "고읍동": "4163010900",
            "광적면 가납리": "4163033021",
            "광적면 광석리": "4163033022",
            "남면 신산리": "4163032021",
            "덕정동": "4163011000",
            "만송동": "4163010700",
            "백석읍 가업리": "4163025024",
            "백석읍 방성리": "4163025021",
            "백석읍 복지리": "4163025023",
            "백석읍 오산리": "4163025022",
            "백석읍 홍죽리": "4163025025",
            "산북동": "4163010500",
            "장흥면 부곡리": "4163034023",
            "장흥면 일영리": "4163034025",
        },
        "포천시": {
            "신읍동":    "4165000100",
            "어룡동":    "4165000200",
            "자작동":    "4165000300",
            "선단동":    "4165000400",
            "설운동":    "4165000500",
            "동교동":    "4165000600",
            "가산면 마산리": "4165033021",
            "군내면 구읍리": "4165031021",
            "군내면 용정리": "4165031022",
            "소흘읍 송우리": "4165025021",
            "소흘읍 이동교리": "4165025022",
            "소흘읍 초가팔리": "4165025028",
            "신북면 가채리": "4165034021",
            "신북면 계류리": "4165034026",
            "신북면 기지리": "4165034022",
            "영북면 운천리": "4165039021",
            "일동면 기산리": "4165037023",
        },
        "여주시": {
            "여주동":    "4167000100",
            "홍문동":    "4167000200",
            "오학동":    "4167000300",
            "창리동":    "4167000400",
            "상동":      "4167000500",
            "하동":      "4167000600",
            "점봉동":    "4167000700",
            "교동":      "4167000800",
            "단현동":    "4167001100",
            "가남읍 신해리": "4167025023",
            "가남읍 심석리": "4167025027",
            "가남읍 태평리": "4167025021",
            "멱곡동": "4167011700",
            "세종대왕면 신지리": "4167034533",
            "연양동": "4167011800",
            "월송동": "4167010900",
            "천송동": "4167012000",
            "현암동": "4167012200",
        },
        # ── Sprint 15: 동두천시 동-level 추가 ──
        "동두천시": {
            "송내동":    "4125010100",
            "지행동":    "4125010200",
            "생연동":    "4125010300",
            "광암동":    "4125010400",
            "걸산동":    "4125010500",
            "보산동":    "4125010600",
            "동두천동":  "4125010700",
            "안흥동":    "4125010800",
            "상봉암동":  "4125010900",
            "하봉암동":  "4125011000",
            "탑동동":    "4125011100",
            "상패동":    "4125011200",
        },
    },
    "인천광역시": {
        "중구": {
            "중앙동1가": "2811010100",
            "중앙동2가": "2811010200",
            "중앙동3가": "2811010300",
            "중앙동4가": "2811010400",
            "해안동1가": "2811010500",
            "해안동2가": "2811010600",
            "해안동3가": "2811010700",
            "해안동4가": "2811010800",
            "관동1가":   "2811010900",
            "관동2가":   "2811011000",
            "관동3가":   "2811011100",
            "항동1가":   "2811011200",
            "항동2가":   "2811011300",
            "항동3가":   "2811011400",
            "항동4가":   "2811011500",
            "항동5가":   "2811011600",
            "항동6가":   "2811011700",
            "항동7가":   "2811011800",
            "송학동1가": "2811011900",
            "송학동2가": "2811012000",
            "송학동3가": "2811012100",
            "사동":      "2811012200",
            "신생동":    "2811012300",
            "신포동":    "2811012400",
            "답동":      "2811012500",
            "신흥동1가": "2811012600",
            "신흥동2가": "2811012700",
            "신흥동3가": "2811012800",
            "선화동":    "2811012900",
            "유동":      "2811013000",
            "율목동":    "2811013100",
            "도원동":    "2811013200",
            "내동":      "2811013300",
            "경동":      "2811013400",
            "용동":      "2811013500",
            "인현동":    "2811013600",
            "전동":      "2811013700",
            "북성동1가": "2811013800",
            "북성동2가": "2811013900",
            "북성동3가": "2811014000",
            "선린동":    "2811014100",
            "송월동1가": "2811014200",
            "송월동2가": "2811014300",
            "송월동3가": "2811014400",
            "중산동":    "2811014500",
            "운남동":    "2811014600",
            "운서동":    "2811014700",
            "운북동":    "2811014800",
            "을왕동":    "2811014900",
            "남북동":    "2811015000",
            "덕교동":    "2811015100",
            "무의동":    "2811015200",
        },
        "동구": {
            "만석동":    "2814010100",
            "화수동":    "2814010200",
            "송현동":    "2814010300",
            "화평동":    "2814010400",
            "창영동":    "2814010500",
            "금곡동":    "2814010600",
            "송림동":    "2814010700",
        },
        "미추홀구": {
            "숭의동":    "2817710100",
            "용현동":    "2817710200",
            "학익동":    "2817710300",
            "도화동":    "2817710400",
            "주안동":    "2817710500",
            "관교동":    "2817710600",
            "문학동":    "2817710700",
        },
        "연수구": {
            "옥련동":    "2818510100",
            "선학동":    "2818510200",
            "연수동":    "2818510300",
            "청학동":    "2818510400",
            "동춘동":    "2818510500",
            "송도동":    "2818510600",
        },
        "남동구": {
            "구월동":    "2820010100",
            "간석동":    "2820010200",
            "만수동":    "2820010300",
            "장수동":    "2820010400",
            "서창동":    "2820010500",
            "운연동":    "2820010600",
            "남촌동":    "2820010700",
            "수산동":    "2820010800",
            "도림동":    "2820010900",
            "논현동":    "2820011000",
            "고잔동":    "2820011100",
        },
        "부평구": {
            "부평동":    "2823710100",
            "십정동":    "2823710200",
            "산곡동":    "2823710300",
            "청천동":    "2823710400",
            "삼산동":    "2823710500",
            "갈산동":    "2823710600",
            "부개동":    "2823710700",
            "일신동":    "2823710800",
            "구산동":    "2823710900",
        },
        "계양구": {
            "효성동":    "2824510100",
            "계산동":    "2824510200",
            "작전동":    "2824510300",
            "서운동":    "2824510400",
            "임학동":    "2824510500",
            "용종동":    "2824510600",
            "병방동":    "2824510700",
            "방축동":    "2824510800",
            "박촌동":    "2824510900",
            "동양동":    "2824511000",
            "귤현동":    "2824511100",
            "상야동":    "2824511200",
            "하야동":    "2824511300",
            "평동":      "2824511400",
            "노오지동":  "2824511500",
            "선주지동":  "2824511600",
            "이화동":    "2824511700",
            "오류동":    "2824511800",
            "갈현동":    "2824511900",
            "둑실동":    "2824512000",
            "목상동":    "2824512100",
            "다남동":    "2824512200",
            "장기동":    "2824512300",
        },
        "서구": {
            "백석동":    "2826010100",
            "시천동":    "2826010200",
            "검암동":    "2826010300",
            "경서동":    "2826010400",
            "공촌동":    "2826010500",
            "연희동":    "2826010600",
            "심곡동":    "2826010700",
            "가정동":    "2826010800",
            "신현동":    "2826010900",
            "석남동":    "2826011000",
            "원창동":    "2826011100",
            "가좌동":    "2826011200",
            "마전동":    "2826011300",
            "당하동":    "2826011400",
            "원당동":    "2826011500",
            "대곡동":    "2826011700",
            "금곡동":    "2826011800",
            "오류동":    "2826011900",
            "왕길동":    "2826012000",
            "불로동":    "2826012100",
            "청라동":    "2826012200",
        },
    },
    "부산광역시": {
        "중구": {
            "영주동":    "2611010100",
            "대창동1가": "2611010200",
            "대창동2가": "2611010300",
            "중앙동1가": "2611010400",
            "중앙동2가": "2611010500",
            "중앙동3가": "2611010600",
            "중앙동4가": "2611010700",
            "중앙동5가": "2611010800",
            "중앙동6가": "2611010900",
            "중앙동7가": "2611011000",
            "동광동1가": "2611011100",
            "동광동2가": "2611011200",
            "동광동3가": "2611011300",
            "동광동4가": "2611011400",
            "동광동5가": "2611011500",
            "대청동1가": "2611011600",
            "대청동2가": "2611011700",
            "대청동3가": "2611011800",
            "대청동4가": "2611011900",
            "보수동1가": "2611012000",
            "보수동2가": "2611012100",
            "보수동3가": "2611012200",
            "부평동1가": "2611012300",
            "부평동2가": "2611012400",
            "부평동3가": "2611012500",
            "부평동4가": "2611012600",
            "신창동1가": "2611012700",
            "신창동2가": "2611012800",
            "신창동3가": "2611012900",
            "신창동4가": "2611013000",
            "창선동1가": "2611013100",
            "창선동2가": "2611013200",
            "광복동1가": "2611013300",
            "광복동2가": "2611013400",
            "광복동3가": "2611013500",
            "남포동1가": "2611013600",
            "남포동2가": "2611013700",
            "남포동3가": "2611013800",
            "남포동4가": "2611013900",
            "남포동5가": "2611014000",
            "남포동6가": "2611014100",
        },
        "서구": {
            "동대신동1가": "2614010100",
            "동대신동2가": "2614010200",
            "동대신동3가": "2614010300",
            "서대신동1가": "2614010400",
            "서대신동2가": "2614010500",
            "서대신동3가": "2614010600",
            "부용동1가":   "2614010700",
            "부용동2가":   "2614010800",
            "부민동1가":   "2614010900",
            "부민동2가":   "2614011000",
            "부민동3가":   "2614011100",
            "토성동1가":   "2614011200",
            "토성동2가":   "2614011300",
            "토성동3가":   "2614011400",
            "아미동1가":   "2614011500",
            "아미동2가":   "2614011600",
            "토성동4가":   "2614011700",
            "토성동5가":   "2614011800",
            "초장동":      "2614011900",
            "충무동1가":   "2614012000",
            "충무동2가":   "2614012100",
            "충무동3가":   "2614012200",
            "남부민동":    "2614012300",
            "암남동":      "2614012400",
        },
        "동구": {
            "초량동":    "2617010100",
            "수정동":    "2617010200",
            "좌천동":    "2617010300",
            "범일동":    "2617010400",
        },
        "영도구": {
            "대교동1가": "2620010100",
            "대교동2가": "2620010200",
            "대평동1가": "2620010300",
            "대평동2가": "2620010400",
            "남항동1가": "2620010500",
            "남항동2가": "2620010600",
            "남항동3가": "2620010700",
            "영선동1가": "2620010800",
            "영선동2가": "2620010900",
            "영선동3가": "2620011000",
            "영선동4가": "2620011100",
            "신선동1가": "2620011200",
            "신선동2가": "2620011300",
            "신선동3가": "2620011400",
            "봉래동1가": "2620011500",
            "봉래동2가": "2620011600",
            "봉래동3가": "2620011700",
            "봉래동4가": "2620011800",
            "봉래동5가": "2620011900",
            "청학동":    "2620012000",
            "동삼동":    "2620012100",
        },
        "부산진구": {
            "양정동":    "2623010100",
            "전포동":    "2623010200",
            "부전동":    "2623010300",
            "범천동":    "2623010400",
            "범전동":    "2623010500",
            "연지동":    "2623010600",
            "초읍동":    "2623010700",
            "부암동":    "2623010800",
            "당감동":    "2623010900",
            "가야동":    "2623011000",
            "개금동":    "2623011100",
        },
        "동래구": {
            "명장동":    "2626010100",
            "안락동":    "2626010200",
            "칠산동":    "2626010300",
            "낙민동":    "2626010400",
            "복천동":    "2626010500",
            "수안동":    "2626010600",
            "명륜동":    "2626010700",
            "온천동":    "2626010800",
            "사직동":    "2626010900",
        },
        "남구": {
            "대연동":    "2629010600",
            "용호동":    "2629010700",
            "용당동":    "2629010800",
            "문현동":    "2629010900",
            "우암동":    "2629011000",
            "감만동":    "2629011100",
        },
        "북구": {
            "금곡동":    "2632010100",
            "화명동":    "2632010200",
            "만덕동":    "2632010300",
            "덕천동":    "2632010400",
            "구포동":    "2632010500",
        },
        "해운대구": {
            "반송동":    "2635010100",
            "석대동":    "2635010200",
            "반여동":    "2635010300",
            "재송동":    "2635010400",
            "우동":      "2635010500",
            "중동":      "2635010600",
            "좌동":      "2635010700",
            "송정동":    "2635010800",
        },
        "사하구": {
            "괴정동":    "2638010100",
            "당리동":    "2638010200",
            "하단동":    "2638010300",
            "신평동":    "2638010400",
            "장림동":    "2638010500",
            "다대동":    "2638010600",
            "구평동":    "2638010700",
            "감천동":    "2638010800",
        },
        "금정구": {
            "두구동":    "2641010100",
            "노포동":    "2641010200",
            "청룡동":    "2641010300",
            "남산동":    "2641010400",
            "선동":      "2641010500",
            "오륜동":    "2641010600",
            "구서동":    "2641010700",
            "장전동":    "2641010800",
            "부곡동":    "2641010900",
            "서동":      "2641011000",
            "금사동":    "2641011100",
            "회동동":    "2641011200",
            "금성동":    "2641011300",
        },
        "강서구": {
            "대저1동":   "2644010100",
            "대저2동":   "2644010200",
            "강동동":    "2644010300",
            "명지동":    "2644010400",
            "죽림동":    "2644010500",
            "식만동":    "2644010600",
            "죽동동":    "2644010700",
            "봉림동":    "2644010800",
            "송정동":    "2644010900",
            "화전동":    "2644011000",
            "녹산동":    "2644011100",
            "생곡동":    "2644011200",
            "구랑동":    "2644011300",
            "지사동":    "2644011400",
            "미음동":    "2644011500",
            "범방동":    "2644011600",
            "신호동":    "2644011700",
            "동선동":    "2644011800",
            "성북동":    "2644011900",
            "눌차동":    "2644012000",
            "천성동":    "2644012100",
            "대항동":    "2644012200",
        },
        "연제구": {
            "거제동":    "2647010100",
            "연산동":    "2647010200",
        },
        "수영구": {
            "망미동":    "2650010100",
            "수영동":    "2650010200",
            "민락동":    "2650010300",
            "광안동":    "2650010400",
            "남천동":    "2650010500",
        },
        "사상구": {
            "삼락동":    "2653010100",
            "모라동":    "2653010200",
            "덕포동":    "2653010300",
            "괘법동":    "2653010400",
            "감전동":    "2653010500",
            "주례동":    "2653010600",
            "학장동":    "2653010700",
            "엄궁동":    "2653010800",
        },
        "기장군": {
            "기장읍":    "2671025000",
            "장안읍":    "2671025300",
            "정관읍":    "2671025600",
            "일광읍":    "2671025900",
            "철마면":    "2671033000",
            "기장읍 교리": "2671025022",
            "기장읍 내리": "2671025034",
            "기장읍 대라리": "2671025026",
            "기장읍 대변리": "2671025028",
            "기장읍 동부리": "2671025021",
            "기장읍 서부리": "2671025025",
            "기장읍 청강리": "2671025027",
            "일광읍 삼성리": "2671025921",
            "일광읍 이천리": "2671025922",
            "장안읍 명례리": "2671025329",
            "정관읍 달산리": "2671025625",
            "정관읍 매학리": "2671025622",
            "정관읍 모전리": "2671025627",
            "정관읍 방곡리": "2671025621",
            "정관읍 용수리": "2671025628",
            "철마면 고촌리": "2671033029",
        },
    },
    "대구광역시": {
        "중구": {
            "동인동1가": "2711010100",
            "동인동2가": "2711010200",
            "동인동3가": "2711010300",
            "동인동4가": "2711010400",
            "삼덕동1가": "2711010500",
            "삼덕동2가": "2711010600",
            "삼덕동3가": "2711010700",
            "수창동":    "2711010800",
            "전동":      "2711010900",
            "서야동":    "2711011000",
            "완전동":    "2711011100",
            "태평로1가": "2711011200",
            "태평로2가": "2711011300",
            "태평로3가": "2711011400",
            "공평동":    "2711011500",
            "동문동":    "2711011600",
            "포정동":    "2711011700",
            "서문로1가": "2711011800",
            "서문로2가": "2711011900",
            "화전동":    "2711012000",
            "교동":      "2711012100",
            "남산동":    "2711012200",
            "대봉동":    "2711012300",
            "봉산동":    "2711012400",
            "인교동":    "2711012500",
            "종로1가":   "2711012600",
            "종로2가":   "2711012700",
            "종로3가":   "2711012800",
            "북내동":    "2711012900",
            "대안동":    "2711013000",
            "덕산동":    "2711013100",
            "하서동":    "2711013200",
            "상서동":    "2711013300",
            "달성동":    "2711013400",
            "장관동":    "2711013500",
            "사일동":    "2711013600",
            "문화동":    "2711013700",
            "용덕동":    "2711013800",
            "녹동":      "2711013900",
            "계산동1가": "2711014000",
            "계산동2가": "2711014100",
            "동산동":    "2711014200",
            "성내1동":   "2711014300",
            "성내2동":   "2711014400",
            "성내3동":   "2711014500",
            "대신동": "2711015400",
            "도원동": "2711012900",
            "서성로1가": "2711013400",
        },
        "동구": {
            "신암동":    "2714010100",
            "신천동":    "2714010200",
            "효목동":    "2714010300",
            "도평동":    "2714010400",
            "불로동":    "2714010500",
            "봉무동":    "2714010600",
            "공산동":    "2714010700",
            "중대동":    "2714010800",
            "내동":      "2714010900",
            "신기동":    "2714011000",
            "서호동":    "2714011100",
            "지묘동":    "2714011200",
            "입석동":    "2714011300",
            "각산동":    "2714011400",
            "둔산동":    "2714011500",
            "율암동":    "2714011600",
            "검사동":    "2714011700",
            "방촌동":    "2714011800",
            "덕곡동":    "2714011900",
            "용계동":    "2714012000",
            "평광동":    "2714012100",
            "괴전동": "2714012600",
            "대림동": "2714012800",
            "도동": "2714010700",
            "동호동": "2714011600",
            "사복동": "2714012900",
            "숙천동": "2714013000",
            "신서동": "2714012400",
            "율하동": "2714011800",
            "지저동": "2714010800",
        },
        "서구": {
            "비산동":    "2717010100",
            "내당동":    "2717010200",
            "원대동1가": "2717010300",
            "원대동2가": "2717010400",
            "원대동3가": "2717010500",
            "평리동":    "2717010600",
            "상리동":    "2717010700",
            "중리동":    "2717010800",
            "이현동":    "2717010900",
            "원평동":    "2717011000",
            "갈산동":    "2717011100",
            "달서동":    "2717011200",
            "두류동":    "2717011300",
            "감천동":    "2717011400",
            "와룡동":    "2717011500",
            "죽전동":    "2717011600",
            "파동":      "2717011700",
            "노곡동":    "2717011800",
            "암산동":    "2717011900",
        },
        "남구": {
            "이천동":    "2720010100",
            "대명동":    "2720010200",
            "봉덕동":    "2720010300",
            "중동":      "2720010400",
            "월성동":    "2720010500",
            "명덕동":    "2720010600",
            "포남동":    "2720010700",
        },
        "북구": {
            "고성동":    "2723010100",
            "칠성동1가": "2723010200",
            "칠성동2가": "2723010300",
            "침산동":    "2723010400",
            "산격동":    "2723010500",
            "대현동":    "2723010600",
            "검단동":    "2723010700",
            "동변동":    "2723010800",
            "서변동":    "2723010900",
            "노원동1가": "2723011000",
            "노원동2가": "2723011100",
            "노원동3가": "2723011200",
            "읍내동":    "2723011300",
            "관음동":    "2723011400",
            "태전동":    "2723011500",
            "구암동":    "2723011600",
            "학정동":    "2723011700",
            "동호동":    "2723011800",
            "국우동":    "2723011900",
            "조야동":    "2723012000",
            "도남동":    "2723012100",
            "금호동":    "2723012200",
            "팔달동":    "2723012300",
            "고성동1가": "2723010300",
            "고성동2가": "2723010400",
            "고성동3가": "2723010500",
            "동천동": "2723012400",
            "매천동": "2723012700",
            "복현동": "2723011200",
            "사수동": "2723013000",
            "연경동": "2723013100",
        },
        "수성구": {
            "범어동":    "2726010100",
            "만촌동":    "2726010200",
            "수성동1가": "2726010300",
            "수성동2가": "2726010400",
            "수성동3가": "2726010500",
            "수성동4가": "2726010600",
            "황금동":    "2726010700",
            "중동":      "2726010800",
            "상동":      "2726010900",
            "파동":      "2726011000",
            "두산동":    "2726011100",
            "지산동":    "2726011200",
            "범물동":    "2726011300",
            "고산동":    "2726011400",
            "노변동":    "2726011500",
            "시지동":    "2726011600",
            "욱수동":    "2726011700",
            "신매동":    "2726011800",
            "매호동":    "2726011900",
            "사월동":    "2726012000",
            "삼덕동":    "2726012100",
            "연호동":    "2726012200",
            "이천동":    "2726012300",
            "성동":      "2726012400",
        },
        "달서구": {
            "성당동":    "2729010100",
            "두류동":    "2729010200",
            "감삼동":    "2729010300",
            "죽전동":    "2729010400",
            "장기동":    "2729010500",
            "용산동":    "2729010600",
            "본동":      "2729010700",
            "본리동":    "2729010800",
            "신당동":    "2729010900",
            "월성동":    "2729011000",
            "월암동":    "2729011100",
            "유천동":    "2729011200",
            "도원동":    "2729011300",
            "파호동":    "2729011400",
            "갈산동":    "2729011500",
            "대천동":    "2729011600",
            "상인동":    "2729011700",
            "진천동":    "2729011800",
            "이곡동":    "2729011900",
            "용계동":    "2729012000",
            "호산동":    "2729012100",
            "대곡동": "2729012300",
            "송현동": "2729012200",
        },
        "달성군": {
            "화원읍":    "2771025000",
            "논공읍":    "2771031000",
            "다사읍":    "2771033500",
            "옥포읍":    "2771034000",
            "현풍읍":    "2771035000",
            "가창면":    "2771032000",
            "하빈면":    "2771036000",
            "구지면":    "2771037500",
            "가창면 용계리": "2771031021",
            "구지면 응암리": "2771038022",
            "구지면 창리": "2771038021",
            "구지면 화산리": "2771038031",
            "논공읍 금포리": "2771025322",
            "논공읍 남리": "2771025327",
            "논공읍 북리": "2771025328",
            "다사읍 매곡리": "2771025628",
            "다사읍 서재리": "2771025625",
            "다사읍 세천리": "2771025626",
            "다사읍 죽곡리": "2771025627",
            "옥포읍 강림리": "2771026223",
            "옥포읍 교항리": "2771026222",
            "옥포읍 본리리": "2771026229",
            "유가읍 봉리": "2771025924",
            "유가읍 쌍계리": "2771025925",
            "현풍읍 상리": "2771026521",
            "현풍읍 성하리": "2771026525",
            "현풍읍 원교리": "2771026526",
            "현풍읍 중리": "2771026522",
            "화원읍 구라리": "2771025022",
            "화원읍 명곡리": "2771025025",
            "화원읍 본리리": "2771025026",
            "화원읍 설화리": "2771025024",
            "화원읍 성산리": "2771025023",
            "화원읍 천내리": "2771025021",
        },
    },
    "광주광역시": {
        "동구": {
            "충장로1가": "2911010100",
            "충장로2가": "2911010200",
            "충장로3가": "2911010300",
            "충장로4가": "2911010400",
            "충장로5가": "2911010500",
            "금남로1가": "2911010600",
            "금남로2가": "2911010700",
            "금남로3가": "2911010800",
            "금남로4가": "2911010900",
            "금남로5가": "2911011000",
            "불로동":    "2911011100",
            "남동":      "2911011200",
            "장동":      "2911011300",
            "궁동":      "2911011400",
            "동명동":    "2911011500",
            "수기동":    "2911011600",
            "황금동":    "2911011700",
            "계림동":    "2911011800",
            "산수동":    "2911011900",
            "지산동":    "2911012000",
            "서남동":    "2911012100",
            "용연동":    "2911012200",
            "용산동":    "2911012300",
            "월남동":    "2911012400",
            "소태동":    "2911012500",
            "선교동": "2911012400",
            "운림동": "2911012100",
            "학동": "2911012200",
        },
        "서구": {
            "양동":      "2914010100",
            "광천동":    "2914010200",
            "유덕동":    "2914010300",
            "치평동":    "2914010400",
            "쌍촌동":    "2914010500",
            "풍암동":    "2914010600",
            "화정동":    "2914010700",
            "농성동":    "2914010800",
            "금호동":    "2914010900",
            "서창동":    "2914011000",
            "세하동":    "2914011100",
            "벽진동":    "2914011200",
            "매월동":    "2914011300",
            "내방동": "2914012100",
            "동천동": "2914013300",
            "마륵동": "2914013100",
            "유촌동": "2914011600",
        },
        "남구": {
            "사동":      "2915510100",
            "봉선동":    "2915510200",
            "주월동":    "2915510300",
            "월산동":    "2915510400",
            "방림동":    "2915510500",
            "백운동":    "2915510600",
            "진월동":    "2915510700",
            "임암동":    "2915510800",
            "송하동":    "2915510900",
            "양림동":    "2915511000",
            "구동":      "2915511100",
            "노대동":    "2915511200",
            "덕남동":    "2915511300",
            "승촌동":    "2915511400",
            "지석동":    "2915511500",
            "압촌동":    "2915511600",
            "화장동":    "2915511700",
            "칠석동":    "2915511800",
            "대지동":    "2915511900",
        },
        "북구": {
            "중흥동":    "2917010100",
            "유동":      "2917010200",
            "누문동":    "2917010300",
            "북동":      "2917010400",
            "임동":      "2917010500",
            "신안동":    "2917010600",
            "용봉동":    "2917010700",
            "오치동":    "2917010800",
            "동림동":    "2917010900",
            "운암동":    "2917011000",
            "우산동":    "2917011100",
            "풍향동":    "2917011200",
            "두암동":    "2917011300",
            "문화동":    "2917011400",
            "각화동":    "2917011500",
            "일곡동":    "2917011600",
            "매곡동":    "2917011700",
            "삼각동":    "2917011800",
            "본촌동":    "2917011900",
            "망월동":    "2917012000",
            "충효동":    "2917012100",
            "화암동":    "2917012200",
            "청풍동":    "2917012300",
            "덕의동":    "2917012400",
            "금곡동":    "2917012500",
            "효령동":    "2917012600",
            "장등동":    "2917012700",
            "신용동":    "2917012800",
            "태령동":    "2917012900",
            "수곡동":    "2917013000",
            "용두동":    "2917013100",
            "연제동":    "2917013200",
            "월출동":    "2917013300",
            "지야동":    "2917013400",
            "양산동":    "2917013500",
            "문흥동": "2917011200",
        },
        "광산구": {
            "송정동":    "2920010100",
            "도산동":    "2920010200",
            "신촌동":    "2920010300",
            "운수동":    "2920010400",
            "동림동":    "2920010500",
            "우산동":    "2920010600",
            "월곡동":    "2920010700",
            "비아동":    "2920010800",
            "장덕동":    "2920010900",
            "수완동":    "2920011000",
            "흑석동":    "2920011100",
            "쌍암동":    "2920011200",
            "산정동":    "2920011300",
            "선암동":    "2920011400",
            "도천동":    "2920011500",
            "임곡동":    "2920011600",
            "동산동":    "2920011700",
            "소촌동":    "2920011800",
            "덕림동":    "2920011900",
            "신룡동":    "2920012000",
            "명화동":    "2920012100",
            "하남동":    "2920012200",
            "안청동":    "2920012300",
            "지죽동":    "2920012400",
            "지평동":    "2920012500",
            "요기동":    "2920012600",
            "삼거동":    "2920012700",
            "오선동":    "2920012800",
            "본덕동":    "2920012900",
            "용봉동":    "2920013000",
            "박호동":    "2920013100",
            "산월동": "2920011700",
            "신가동": "2920011900",
            "신창동": "2920011800",
            "운남동": "2920012000",
            "월계동": "2920011500",
        },
    },
    "대전광역시": {
        "동구": {
            "인동":      "3011010100",
            "원동":      "3011010200",
            "효동":      "3011010300",
            "천동":      "3011010400",
            "가양동":    "3011010500",
            "용운동":    "3011010600",
            "대동":      "3011010700",
            "자양동":    "3011010800",
            "신흥동":    "3011010900",
            "판암동":    "3011011000",
            "삼성동":    "3011011100",
            "용전동":    "3011011200",
            "성남동":    "3011011300",
            "홍도동":    "3011011400",
            "신촌동":    "3011011500",
            "소제동":    "3011011600",
            "정동":      "3011011700",
            "중동":      "3011011800",
            "태평동":    "3011011900",
            "대청동":    "3011012000",
            "비룡동":    "3011012100",
            "주산동":    "3011012200",
            "세천동":    "3011012300",
            "마산동":    "3011012400",
            "직동":      "3011012500",
            "이사동":    "3011012600",
            "주촌동":    "3011012700",
            "장척동":    "3011012800",
            "가오동":    "3011012900",
            "용수동":    "3011013000",
            "오동":      "3011013100",
            "소호동":    "3011013200",
            "내탑동":    "3011013300",
            "사성동":    "3011013400",
            "구도동":    "3011013500",
            "신상동":    "3011013600",
            "신하동":    "3011013700",
            "신인동":    "3011013800",
            "효평동":    "3011013900",
            "추동":      "3011014000",
            "산내동":    "3011014100",
            "이현동":    "3011014200",
            "낭월동":    "3011014300",
            "대별동":    "3011014400",
            "하소동":    "3011014500",
            "대성동": "3011013900",
        },
        "중구": {
            "은행동":    "3014010100",
            "선화동":    "3014010200",
            "목동":      "3014010300",
            "중촌동":    "3014010400",
            "대흥동":    "3014010500",
            "문창동":    "3014010600",
            "석교동":    "3014010700",
            "호동":      "3014010800",
            "옥계동":    "3014010900",
            "대사동":    "3014011000",
            "부사동":    "3014011100",
            "용두동":    "3014011200",
            "오류동":    "3014011300",
            "태평동":    "3014011400",
            "유천동":    "3014011500",
            "문화동":    "3014011600",
            "산성동":    "3014011700",
            "안영동":    "3014011800",
            "사정동":    "3014011900",
            "무수동":    "3014012000",
            "침산동":    "3014012100",
            "정생동":    "3014012200",
            "어남동":    "3014012300",
            "구완동":    "3014012400",
            "가양동":    "3014012500",
            "금동":      "3014012600",
            "목달동":    "3014012700",
            "도마동":    "3014012800",
            "용전동":    "3014012900",
            "봉명동":    "3014013000",
        },
        "서구": {
            "복수동":    "3017010100",
            "도마동":    "3017010200",
            "정림동":    "3017010300",
            "변동":      "3017010400",
            "가장동":    "3017010500",
            "내동":      "3017010600",
            "괴정동":    "3017010700",
            "가수원동":  "3017010800",
            "도안동":    "3017010900",
            "관저동":    "3017011000",
            "흑석동":    "3017011100",
            "매노동":    "3017011200",
            "오동":      "3017011300",
            "용촌동":    "3017011400",
            "산직동":    "3017011500",
            "장안동":    "3017011600",
            "평촌동":    "3017011700",
            "갑동":      "3017011800",
            "둔산동":    "3017011900",
            "탄방동":    "3017012000",
            "삼천동":    "3017012100",
            "월평동":    "3017012200",
            "만년동":    "3017012300",
            "신동":      "3017012400",
            "봉곡동":    "3017012500",
            "오룡동":    "3017012600",
            "갈마동": "3017011100",
            "용문동": "3017010500",
        },
        "유성구": {
            "원내동":    "3020010100",
            "교촌동":    "3020010200",
            "대정동":    "3020010300",
            "성북동":    "3020010400",
            "원신흥동":  "3020010500",
            "상대동":    "3020010600",
            "하기동":    "3020010700",
            "송강동":    "3020010800",
            "추목동":    "3020010900",
            "금고동":    "3020011000",
            "봉산동":    "3020011100",
            "계산동":    "3020011200",
            "화암동":    "3020011300",
            "방동":      "3020011400",
            "금동":      "3020011500",
            "세동":      "3020011600",
            "관평동":    "3020011700",
            "용계동":    "3020011800",
            "죽동":      "3020011900",
            "덕명동":    "3020012000",
            "지족동":    "3020012100",
            "노은동":    "3020012200",
            "신봉동":    "3020012300",
            "수남동":    "3020012400",
            "구암동":    "3020012500",
            "복용동":    "3020012600",
            "전민동":    "3020012700",
            "원촌동":    "3020012800",
            "궁동":      "3020012900",
            "어은동":    "3020013000",
            "구성동":    "3020013100",
            "가정동":    "3020013200",
            "반석동":    "3020013300",
            "신성동":    "3020013400",
            "문지동":    "3020013500",
            "외삼동":    "3020013600",
            "탑립동":    "3020013700",
            "용산동":    "3020013800",
            "자운동":    "3020013900",
            "신도동":    "3020014000",
            "둔곡동":    "3020014100",
            "구룡동":    "3020014200",
            "안산동":    "3020014300",
            "상남동":    "3020014400",
            "학하동":    "3020014500",
            "갑동":      "3020014600",
            "장동":      "3020014700",
            "대동":      "3020014800",
            "계룡동":    "3020014900",
            "하소동":    "3020015000",
            "도룡동": "3020012700",
            "봉명동": "3020011100",
            "장대동": "3020011700",
        },
        "대덕구": {
            "오정동":    "3023010100",
            "읍내동":    "3023010200",
            "중리동":    "3023010300",
            "법동":      "3023010400",
            "송촌동":    "3023010500",
            "덕암동":    "3023010600",
            "목상동":    "3023010700",
            "장동":      "3023010800",
            "비래동":    "3023010900",
            "용호동":    "3023011000",
            "신탄진동":  "3023011100",
            "석봉동":    "3023011200",
            "와동":      "3023011300",
            "회덕동":    "3023011400",
            "연축동":    "3023011500",
            "삼정동":    "3023011600",
            "부수동":    "3023011700",
            "문평동":    "3023011800",
            "평촌동":    "3023011900",
            "황호동":    "3023012000",
            "상서동":    "3023012100",
            "이현동":    "3023012200",
            "대화동": "3023010200",
            "신대동": "3023010500",
        },
    },
    "울산광역시": {
        "중구": {
            "학성동":    "3111010100",
            "교동":      "3111010200",
            "성남동":    "3111010300",
            "옥교동":    "3111010400",
            "우정동":    "3111010500",
            "태화동":    "3111010600",
            "다운동":    "3111010700",
            "동동":      "3111010800",
            "서동":      "3111010900",
            "남외동":    "3111011000",
            "장현동":    "3111011100",
            "반구동":    "3111011200",
            "약사동":    "3111011300",
            "복산동":    "3111011400",
            "북정동":    "3111011500",
            "유곡동":    "3111011600",
            "성안동": "3111010900",
            "학산동": "3111010200",
        },
        "남구": {
            "삼산동":    "3114010100",
            "달동":      "3114010200",
            "무거동":    "3114010300",
            "옥동":      "3114010400",
            "신정동":    "3114010500",
            "선암동":    "3114010600",
            "야음동":    "3114010700",
            "장생포동":  "3114010800",
            "용연동":    "3114010900",
            "매암동":    "3114011000",
            "두왕동":    "3114011100",
            "황성동":    "3114011200",
            "수암동":    "3114011300",
            "부곡동":    "3114011400",
            "상개동":    "3114011500",
            "하개동":    "3114011600",
        },
        "동구": {
            "방어동":    "3117010100",
            "화정동":    "3117010200",
            "전하동":    "3117010300",
            "일산동":    "3117010400",
            "미포동":    "3117010500",
            "서부동":    "3117010600",
            "남목동":    "3117010700",
            "대송동":    "3117010800",
            "주전동":    "3117010900",
            "동부동": "3117010700",
        },
        "북구": {
            "신천동":    "3120010100",
            "농소동":    "3120010200",
            "중산동":    "3120010300",
            "송정동":    "3120010400",
            "천곡동":    "3120010500",
            "효문동":    "3120010600",
            "매곡동":    "3120010700",
            "창평동":    "3120010800",
            "호계동":    "3120010900",
            "양정동":    "3120011000",
            "진장동":    "3120011100",
            "시례동":    "3120011200",
            "하대동":    "3120011300",
            "상안동":    "3120011400",
            "달천동": "3120010900",
            "명촌동": "3120012000",
            "산하동": "3120011800",
            "연암동": "3120012200",
            "염포동": "3120012700",
            "정자동": "3120011300",
            "화봉동": "3120012500",
        },
        "울주군": {
            "온산읍":    "3171025000",
            "언양읍":    "3171025300",
            "온양읍":    "3171031000",
            "두서면":    "3171032000",
            "두동면":    "3171033000",
            "범서읍":    "3171033500",
            "청량읍":    "3171034000",
            "삼남읍":    "3171035000",
            "웅촌면":    "3171036000",
            "서생면":    "3171037000",
            "삼동면":    "3171038000",
            "상북면":    "3171039000",
            "강동면":    "3171040000",
            "범서읍 구영리": "3171025927",
            "범서읍 굴화리": "3171025924",
            "범서읍 천상리": "3171025922",
            "삼남읍 가천리": "3171026525",
            "삼남읍 교동리": "3171026521",
            "삼남읍 방기리": "3171026524",
            "삼남읍 신화리": "3171026523",
            "상북면 궁근정리": "3171038030",
            "상북면 천전리": "3171038028",
            "상북면 향산리": "3171038032",
            "서생면 서생리": "3171031027",
            "서생면 진하리": "3171031028",
            "언양읍 동부리": "3171025330",
            "언양읍 반송리": "3171025321",
            "언양읍 반천리": "3171025322",
            "언양읍 서부리": "3171025331",
            "언양읍 송대리": "3171025325",
            "언양읍 어음리": "3171025324",
            "온산읍 덕신리": "3171025032",
            "온양읍 남창리": "3171025624",
            "온양읍 대안리": "3171025622",
            "온양읍 망양리": "3171025623",
            "온양읍 발리": "3171025621",
            "온양읍 운화리": "3171025629",
            "웅촌면 곡천리": "3171034023",
            "웅촌면 대복리": "3171034029",
            "청량읍 덕하리": "3171026221",
            "청량읍 삼정리": "3171026227",
            "청량읍 상남리": "3171026223",
            "청량읍 율리": "3171026228",
        },
    },
    "세종특별자치시": {
        "세종시": {
            "한솔동":    "3611010100",
            "도담동":    "3611010200",
            "어진동":    "3611010300",
            "해밀동":    "3611010400",
            "아름동":    "3611010500",
            "종촌동":    "3611010600",
            "고운동":    "3611010700",
            "보람동":    "3611010800",
            "대평동":    "3611010900",
            "소담동":    "3611011000",
            "반곡동":    "3611011100",
            "새롬동":    "3611011200",
            "나성동":    "3611011300",
            "다정동":    "3611011400",
            "은하수동":  "3611011500",
            "산울동":    "3611011600",
            "가람동":    "3611011700",
            "조치원읍":  "3611025300",
            "연동면":    "3611025000",
            "금남면":    "3611031000",
            "장군면":    "3611032000",
            "연서면":    "3611033000",
            "전의면":    "3611034000",
            "전동면":    "3611035000",
            "소정면":    "3611036000",
            "부강면":    "3611037000",
            "금남면 용포리": "3611034021",
            "부강면 부강리": "3611033021",
            "소정면 운당리": "3611039022",
            "연동면 명학리": "3611032023",
            "연서면 봉암리": "3611036033",
            "장군면 금암리": "3611035025",
            "전동면 노장리": "3611038021",
            "전의면 동교리": "3611037022",
            "전의면 유천리": "3611037026",
            "조치원읍 교리": "3611025024",
            "조치원읍 남리": "3611025027",
            "조치원읍 번암리": "3611025031",
            "조치원읍 봉산리": "3611025033",
            "조치원읍 상리": "3611025022",
            "조치원읍 신안리": "3611025032",
            "조치원읍 신흥리": "3611025029",
            "조치원읍 원리": "3611025021",
            "조치원읍 정리": "3611025025",
            "조치원읍 죽림리": "3611025030",
            "조치원읍 침산리": "3611025028",
            "집현동": "3611011800",
        },
    },
}


def get_lawdcd(
    sido: str,
    sigungu: str,
    dong: Optional[str] = None,
) -> Optional[str]:
    """법정동코드를 조회한다.

    dong이 있으면 동-level 코드 반환 (KB API 호환),
    없으면 구-level 코드 반환 (fallback).

    Args:
        sido: 시/도 (예: "서울특별시")
        sigungu: 시/군/구 (예: "강남구")
        dong: 동 이름 (예: "대치동", 선택)

    Returns:
        10자리 법정동코드 문자열, 없으면 None
    """
    if dong:
        dong_map = DONG_LAWDCD_MAP.get(sido, {}).get(sigungu, {})
        code = dong_map.get(dong)
        if code:
            return code
    # fallback: 구-level 코드
    return LAWDCD_MAP.get(sido, {}).get(sigungu)


class KBPriceClient:
    """KB부동산 내부 API를 호출하는 HTTP 클라이언트.

    - httpx.AsyncClient 사용 (비동기 HTTP 요청)
    - 요청 간 딜레이(rate limiting) 준수
    - 에러 발생 시 지수 백오프 재시도
    - kbland.kr 프론트엔드 요청을 모사하는 헤더 설정
    """

    def __init__(self, delay: Optional[float] = None):
        """
        Args:
            delay: 요청 간 딜레이(초). None이면 기본값(KB_DELAY_SECONDS) 사용
        """
        self._client: Optional[httpx.AsyncClient] = None
        self._delay = delay if delay is not None else KB_DELAY_SECONDS
        # 5자리 시군구코드 조회 결과 캐시 (경기도 등 10자리 미지원 지역용)
        self._sigungu_cache: Dict[str, List[Dict[str, Any]]] = {}

    async def _get_client(self) -> httpx.AsyncClient:
        """lazy-init으로 AsyncClient 생성."""
        if self._client is None or self._client.is_closed:
            self._client = httpx.AsyncClient(
                headers=DEFAULT_HEADERS,
                timeout=httpx.Timeout(30.0, connect=10.0),
                follow_redirects=True,
            )
        return self._client

    async def close(self):
        """클라이언트 리소스 정리."""
        if self._client and not self._client.is_closed:
            await self._client.aclose()
            self._client = None

    async def _throttle(self):
        """요청 간 딜레이 적용 (rate limiting)."""
        await asyncio.sleep(self._delay)

    async def _request(
        self,
        url: str,
        params: Optional[Dict] = None,
    ) -> Optional[Dict[str, Any]]:
        """HTTP GET 요청 실행 (재시도 로직 포함).

        Args:
            url: 요청 URL
            params: 쿼리 파라미터

        Returns:
            JSON 응답의 dataBody, 실패 시 None
        """
        client = await self._get_client()

        for attempt in range(1, MAX_RETRIES + 1):
            try:
                response = await client.get(url, params=params)

                if response.status_code == 200:
                    data = response.json()
                    header = data.get("dataHeader", {})
                    # resultCode "10000" = 정상
                    if header.get("resultCode") == "10000":
                        return data.get("dataBody")
                    else:
                        logger.warning(
                            "KB API 비정상 응답: %s (code=%s)",
                            header.get("message", "?"),
                            header.get("resultCode", "?"),
                        )
                        return data.get("dataBody")

                if response.status_code == 429:
                    wait = RETRY_BACKOFF_BASE ** attempt * 2
                    logger.warning(
                        "KB API Rate limited. %.1f초 후 재시도 (%d/%d)",
                        wait, attempt, MAX_RETRIES,
                    )
                    await asyncio.sleep(wait)
                    continue

                if response.status_code in (403, 401):
                    logger.error(
                        "KB API 접근 차단 (%d): 헤더 또는 IP 차단 가능성",
                        response.status_code,
                    )
                    return None

                logger.warning(
                    "KB API HTTP %d (%d/%d)",
                    response.status_code, attempt, MAX_RETRIES,
                )

            except httpx.TimeoutException:
                logger.warning("KB API 타임아웃 (%d/%d)", attempt, MAX_RETRIES)
            except httpx.HTTPError as e:
                logger.warning("KB API 에러: %s (%d/%d)", str(e), attempt, MAX_RETRIES)

            # 지수 백오프 대기
            if attempt < MAX_RETRIES:
                wait = RETRY_BACKOFF_BASE ** attempt
                await asyncio.sleep(wait)

        logger.error("KB API 최대 재시도 횟수 초과: %s", url)
        return None

    # ──────────────────────────────────────────
    # 지역별 단지 목록 조회
    # ──────────────────────────────────────────

    async def get_complex_list(
        self,
        lawdcd: str,
    ) -> List[Dict[str, Any]]:
        """법정동코드로 해당 지역의 아파트 단지 목록을 조회한다.

        10자리 법정동코드로 조회 후, 결과가 없으면 5자리 시군구코드로 재시도.
        (경기도 등 일부 지역은 10자리 코드 미지원, 5자리만 지원)

        Args:
            lawdcd: 법정동코드 (10자리, 예: "1168010600" = 대치동)

        Returns:
            단지 목록 리스트 (단지기본일련번호, 단지명, 주소 등 포함)
        """
        await self._throttle()
        body = await self._request(COMPLEX_LIST_URL, params={"법정동코드": lawdcd})

        if body and isinstance(body, dict):
            data = body.get("data", [])
            if data:
                return data

        # 10자리 법정동코드로 결과 없음 → 5자리 시군구코드로 fallback
        # 경기도(41xx) 등 일부 지역은 10자리 코드를 지원하지 않음
        if len(lawdcd) == 10:
            sigungu_code = lawdcd[:5]
            # 캐시 확인 (같은 시군구의 다른 동에서 이미 조회한 경우)
            if sigungu_code in self._sigungu_cache:
                logger.debug("5자리 캐시 히트: %s (원본: %s)", sigungu_code, lawdcd)
                return self._sigungu_cache[sigungu_code]

            logger.info("10자리 결과 없음, 5자리 fallback: %s → %s", lawdcd, sigungu_code)
            await self._throttle()
            body = await self._request(COMPLEX_LIST_URL, params={"법정동코드": sigungu_code})
            if body and isinstance(body, dict):
                result = body.get("data", [])
                self._sigungu_cache[sigungu_code] = result
                return result

        return []

    # ──────────────────────────────────────────
    # 단지 간략 정보 조회 (시세 범위 포함)
    # ──────────────────────────────────────────

    async def get_complex_brif(
        self,
        complex_id: int,
    ) -> Optional[Dict[str, Any]]:
        """KB 단지번호로 단지 간략 정보를 조회한다.

        최소/최대 매매일반거래가 등 시세 범위 정보가 포함되어 있다.

        Args:
            complex_id: KB 단지기본일련번호

        Returns:
            단지 간략 정보 dict, 실패 시 None
        """
        await self._throttle()
        body = await self._request(
            COMPLEX_BRIF_URL,
            params={"단지기본일련번호": str(complex_id), "매물종별구분": "01"},
        )

        if body and isinstance(body, dict):
            return body.get("data")
        return None

    # ──────────────────────────────────────────
    # 단지 면적별 타입 정보 조회
    # ──────────────────────────────────────────

    async def get_complex_types(
        self,
        complex_id: int,
    ) -> List[Dict[str, Any]]:
        """KB 단지번호로 면적별 타입 정보를 조회한다.

        면적일련번호, 전용면적, 공급면적 등을 반환한다.
        이 면적일련번호가 KB시세 조회에 필요하다.

        Args:
            complex_id: KB 단지기본일련번호

        Returns:
            면적 타입 리스트
        """
        await self._throttle()
        body = await self._request(
            COMPLEX_TYPE_URL,
            params={"단지기본일련번호": str(complex_id), "매물종별구분": "01"},
        )

        if body and isinstance(body, dict):
            return body.get("data", [])
        return []

    # ──────────────────────────────────────────
    # 면적별 KB시세 상세 조회
    # ──────────────────────────────────────────

    async def get_price_by_area(
        self,
        complex_id: int,
        area_seq: int,
    ) -> Optional[Dict[str, Any]]:
        """KB 단지번호 + 면적일련번호로 상세 KB시세를 조회한다.

        매매일반거래가, 매매상한가, 매매하한가 등을 반환한다.

        Args:
            complex_id: KB 단지기본일련번호
            area_seq: 면적일련번호 (typInfo에서 가져온 값)

        Returns:
            시세 정보 dict, 실패 시 None
        """
        await self._throttle()
        body = await self._request(
            PRICE_INFO_URL,
            params={
                "단지기본일련번호": str(complex_id),
                "면적일련번호": str(area_seq),
                "매물종별구분": "01",
            },
        )

        if body and isinstance(body, dict):
            data = body.get("data", {})
            # 시세 배열에서 첫번째 항목 추출
            sise_list = data.get("시세", [])
            if sise_list:
                return sise_list[0]
        return None

    # ──────────────────────────────────────────
    # 단지의 전체 면적별 KB시세 조회 (통합)
    # ──────────────────────────────────────────

    async def get_all_prices(
        self,
        complex_id: int,
    ) -> List[Dict[str, Any]]:
        """KB 단지번호로 모든 면적의 KB시세를 한번에 조회한다.

        1) 면적 타입 목록 조회
        2) 매매건수가 있는 면적별로 시세 조회
        3) 정규화된 시세 리스트 반환

        Args:
            complex_id: KB 단지기본일련번호

        Returns:
            면적별 KB시세 리스트 [{area_sqm, price_lower, price_mid, price_upper}, ...]
        """
        # 1단계: 면적 타입 조회
        types = await self.get_complex_types(complex_id)
        if not types:
            logger.warning("KB 면적 타입 조회 실패: complex_id=%d", complex_id)
            return []

        results = []
        # 이미 조회한 면적 중복 방지 (동일 면적이 여러 타입으로 존재)
        seen_areas = set()

        for typ in types:
            area_seq = typ.get("면적일련번호")
            area_sqm_str = typ.get("전용면적", "")
            if not area_seq or not area_sqm_str:
                continue

            try:
                area_sqm = float(area_sqm_str)
            except (ValueError, TypeError):
                continue

            # 동일 면적 중복 스킵 (소수점 1자리로 반올림하여 비교)
            area_key = round(area_sqm, 1)
            if area_key in seen_areas:
                continue

            # 2단계: 면적별 시세 조회
            price_data = await self.get_price_by_area(complex_id, area_seq)
            if not price_data:
                continue

            # 3단계: 시세 파싱
            price_mid = price_data.get("매매일반거래가")
            price_upper = price_data.get("매매상한가")

            # 하한가 필드가 여러 이름으로 존재할 수 있음
            price_lower = price_data.get("매매하한가") or price_data.get("매매하한거래가")

            # 최소한 일반거래가가 있어야 유효
            if price_mid is None:
                continue

            seen_areas.add(area_key)
            results.append({
                "area_sqm": area_sqm,
                "price_lower": price_lower,
                "price_mid": price_mid,
                "price_upper": price_upper,
            })

            logger.info(
                "KB시세: %d | %.1f㎡ | 일반=%s 상한=%s 하한=%s",
                complex_id, area_sqm, price_mid, price_upper, price_lower,
            )

        return results

    # ──────────────────────────────────────────
    # 네이버 부동산 단지와 KB 단지 매칭
    # ──────────────────────────────────────────

    # ──────────────────────────────────────────
    # 편의 메서드: 네이버 단지 → KB시세 한번에 조회
    # ──────────────────────────────────────────

    async def get_prices_for_complex(
        self,
        complex_name: str,
        sido: str = "서울특별시",
        sigungu: str = "",
        dong: Optional[str] = None,
        dong_code: Optional[str] = None,
        address: Optional[str] = None,
    ) -> Tuple[Optional[str], List[Dict[str, Any]]]:
        """네이버 단지명으로 KB 단지를 매칭하고 시세를 한번에 조회한다.

        1) dong_code가 있으면 직접 사용, 없으면 sido+sigungu+dong으로 조회
        2) match_complex로 KB 단지 매칭
        3) get_all_prices로 전체 면적별 시세 조회

        Args:
            complex_name: 아파트 단지명 (네이버 기준)
            sido: 시/도 (예: "서울특별시")
            sigungu: 시/군/구 (예: "강남구")
            dong: 동 이름 (예: "대치동") - 동-level 코드 조회에 사용
            dong_code: 법정동코드 10자리 (DB에서 전달, 우선 사용)
            address: 주소 (미사용, 호환성 유지)

        Returns:
            (kb_complex_id 문자열, 면적별 시세 리스트) 튜플.
            매칭 실패 시 (None, [])
        """
        # 법정동코드 조회: dong_code 우선, fallback: 동 이름 → DONG_LAWDCD_MAP
        lawdcd = dong_code or get_lawdcd(sido, sigungu, dong)
        if not lawdcd:
            logger.warning("법정동코드 없음: %s %s %s", sido, sigungu, dong or "")
            return None, []

        # KB 단지 매칭 (dong 전달하여 pre-filter 활성화)
        matched = await self.match_complex(complex_name, lawdcd, dong=dong)
        if not matched:
            return None, []

        kb_id = matched.get("단지기본일련번호")
        if not kb_id:
            return None, []

        # 전체 면적별 시세 조회
        prices = await self.get_all_prices(int(kb_id))
        return str(kb_id), prices

    # ──────────────────────────────────────────
    # 네이버 부동산 단지와 KB 단지 매칭
    # ──────────────────────────────────────────

    async def match_complex(
        self,
        complex_name: str,
        lawdcd: str,
        dong: Optional[str] = None,
    ) -> Optional[Dict[str, Any]]:
        """네이버 부동산 단지명으로 KB 단지를 매칭한다.

        해당 지역의 단지 목록에서 이름이 가장 유사한 단지를 찾는다.
        dong이 주어지면 주소 필드로 pre-filter하여 후보를 좁힌다.

        Args:
            complex_name: 아파트 단지명 (네이버 기준)
            lawdcd: 법정동코드 (10자리)
            dong: 동 이름 (pre-filter용)

        Returns:
            매칭된 KB 단지 정보 dict, 실패 시 None
        """
        # 해당 지역 단지 목록 조회
        complexes = await self.get_complex_list(lawdcd)
        if not complexes:
            logger.warning("KB 단지 목록 조회 실패: lawdcd=%s", lawdcd)
            return None

        # match_from_list에 위임 (dong pre-filter + 다단계 스코어링)
        return self.match_from_list(complex_name, complexes, dong=dong)

    def match_from_list(
        self,
        complex_name: str,
        kb_complexes: List[Dict[str, Any]],
        dong: Optional[str] = None,
    ) -> Optional[Dict[str, Any]]:
        """이미 조회된 KB 단지 목록에서 이름으로 매칭한다.

        get_complex_list()를 재호출하지 않고 캐시된 목록을 재사용할 수 있어,
        동 단위 배치 처리 시 API 호출 횟수를 대폭 줄인다.

        dong이 주어지면 주소 필드로 pre-filter하여 후보를 좁힌다
        (5자리 시군구코드 fallback 시 300+개 → 20~30개로 축소).

        Args:
            complex_name: 아파트 단지명 (정규화 전)
            kb_complexes: get_complex_list()의 반환값 (단지 목록)
            dong: 동 이름 (예: "철산동"), pre-filter에 사용

        Returns:
            매칭된 KB 단지 dict, 실패 시 None
        """
        # 동 이름으로 후보 축소 (5자리 fallback 시 핵심 최적화)
        candidates = _filter_by_dong(kb_complexes, dong) if dong else kb_complexes

        clean_target = _normalize_name(complex_name)
        best_match = None
        best_score = 0

        for cx in candidates:
            kb_name = cx.get("단지명", "")
            clean_kb = _normalize_name(kb_name)
            score = _calc_match_score(clean_target, clean_kb)
            if score > best_score:
                best_score = score
                best_match = cx

        # threshold 55: Level 5(fuzzy) 40~54점은 false positive 방지 위해 의도적으로 제외
        if best_match and best_score >= 55:
            logger.info(
                "KB 매칭(캐시): '%s' -> '%s' (ID=%s, score=%d)",
                complex_name,
                best_match.get("단지명", "?"),
                best_match.get("단지기본일련번호", "?"),
                best_score,
            )
            return best_match

        # pre-filter 실패 시 전체 리스트로 재시도
        if dong and candidates != kb_complexes:
            logger.debug(
                "KB 동 필터 매칭 실패, 전체 리스트 재시도: '%s' dong=%s",
                complex_name, dong,
            )
            return self.match_from_list(complex_name, kb_complexes, dong=None)

        # 매칭 실패 시 top-3 후보 디버그 로깅
        if logger.isEnabledFor(logging.DEBUG):
            all_scores = []
            for cx in candidates:
                kb_name = cx.get("단지명", "")
                clean_kb = _normalize_name(kb_name)
                s = _calc_match_score(clean_target, clean_kb)
                if s > 0:
                    all_scores.append((s, kb_name))
            all_scores.sort(reverse=True)
            top3 = all_scores[:3]
            logger.debug(
                "KB 매칭 실패(캐시): '%s' (정규화: '%s') | 후보 %d개 | top3: %s",
                complex_name, clean_target, len(candidates), top3,
            )

        return None


# ──────────────────────────────────────────
# 내부 헬퍼 함수들
# ──────────────────────────────────────────

def _normalize_name(name: str) -> str:
    """단지명 정규화 (구분 정보 보존 + 브랜드 약어 통일 버전).

    N단지/N차 정보를 보존하고, 괄호 내용에서 단지 번호를 추출하여 유지한다.
    브랜드 약어를 통일하여 "엘지"↔"LG", "에스케이"↔"SK" 등의 불일치를 해소한다.
    """
    # 괄호 안 단지/차 번호 추출: "(1단지)" → suffix로 보존
    danji = re.search(r"\((\d+단지)\)", name)
    cha = re.search(r"\((\d+차)\)", name)
    suffix = ""
    if danji:
        suffix = danji.group(1)
    elif cha:
        suffix = cha.group(1)

    # 괄호 및 괄호 내용 제거
    cleaned = re.sub(r"\([^)]*\)", "", name)
    # 불필요 접미사 제거
    cleaned = re.sub(r"아파트$", "", cleaned)
    # 괄호에서 추출한 단지/차 번호 붙이기
    if suffix and suffix not in cleaned:
        cleaned = cleaned + suffix
    # 공백, 특수문자 제거 전에 브랜드 약어 통일 (대소문자 무관)
    cleaned = _unify_brand(cleaned)
    # 공백, 특수문자 제거 (숫자는 보존)
    cleaned = re.sub(r"[^\w가-힣0-9]", "", cleaned.lower())
    return cleaned.strip()


def _unify_brand(name: str) -> str:
    """브랜드 약어/영문을 한글 표기로 통일한다.

    DB 단지명과 KB 단지명에서 동일 브랜드가 다르게 표기되는 문제를 해소.
    예: "엘지" ↔ "LG", "에스케이" ↔ "SK", "e-편한세상" ↔ "이편한세상"

    처리 순서가 중요:
    1) 특수문자 치환 (& → 앤)
    2) e편한세상 계열 통일
    3) 영문 단어 → 한글 (VILLAGE 먼저, 그 다음 VIEW 등)
    4) 브랜드 약어 → 한글 (LG, SK 등 — 영문 단어 처리 후)

    Note: \\b(word boundary)는 한글이 Unicode word char로 인식되어
    "LG원앙"에서 작동하지 않으므로, 대신 ASCII 알파벳 기준
    lookbehind/lookahead를 사용한다.
    """
    result = name

    # 1단계: 특수문자 치환
    result = result.replace("&", "앤")

    # 2단계: e편한세상 계열 통일 (영문 단어 치환 전)
    result = re.sub(r"(?i)e-편한세상", "이편한세상", result)
    result = re.sub(r"(?i)e편한세상", "이편한세상", result)

    # 3단계: 영문 단어 → 한글 (긴/복합 패턴부터 처리)
    word_map = [
        # 복합 브랜드명 (먼저 처리해야 개별 단어 치환과 충돌 방지)
        (r"(?i)I[\-\s]?PARK", "아이파크"),   # I-PARK, IPARK, I PARK
        (r"(?i)I[\-\s]?Class", "아이클래스"), # I-Class, IClass
        (r"(?i)TOP[\-\s]?Class", "탑클래스"), # TOP-Class, TOPClass
        # 일반 영문 단어 (긴 것부터)
        (r"(?i)VILLAGE", "빌리지"),
        (r"(?i)PALACE", "팰리스"),
        (r"(?i)CLASSIC", "클래식"),
        (r"(?i)CLASS", "클래스"),
        (r"(?i)HOUSE", "하우스"),
        (r"(?i)TOWER", "타워"),
        (r"(?i)TOWN", "타운"),
        (r"(?i)VIEW", "뷰"),
        (r"(?i)PARK", "파크"),
        (r"(?i)CITY", "시티"),
        (r"(?i)HILL[S]?", "힐"),
        (r"(?i)VILLE", "빌"),
        (r"(?i)SQUARE", "스퀘어"),
        (r"(?i)CENTRAL", "센트럴"),
        (r"(?i)GRAND", "그랜드"),
        (r"(?i)PREMIER", "프리미어"),
        (r"(?i)SCIENCE", "사이언스"),
        (r"(?i)OCEAN", "오션"),
        (r"(?i)GREEN", "그린"),
        (r"(?i)GOLD", "골드"),
        (r"(?i)NOBLE", "노블"),
        (r"(?i)STELLA", "스텔라"),
        (r"(?i)FOREST",    "포레스트"),
        (r"(?i)VALLEY",    "밸리"),
        (r"(?i)TERRACE",   "테라스"),
        (r"(?i)PLUS",      "플러스"),
        (r"(?i)PRIME",     "프라임"),
        (r"(?i)PRESTIGE",  "프레스티지"),
        (r"(?i)\bTHE\b",   "더"),
        (r"(?i)GRANDE?",   "그랑"),
    ]
    for pattern, replacement in word_map:
        result = re.sub(pattern, replacement, result)

    # 4단계: 브랜드 약어 → 한글
    # (?<![a-zA-Z])..(?![a-zA-Z]) = ASCII 알파벳이 인접하지 않을 때만 매칭
    # "LG원앙" ✓ (뒤에 한글), "VILLAGE" ✗ (이미 3단계에서 치환됨)
    abbr_map = [
        (r"(?<![a-zA-Z])KCC(?![a-zA-Z])", "케이씨씨"),
        (r"(?<![a-zA-Z])KBS(?![a-zA-Z])", "케이비에스"),
        (r"(?<![a-zA-Z])LG(?![a-zA-Z])", "엘지"),
        (r"(?<![a-zA-Z])LH(?![a-zA-Z])", "엘에이치"),
        (r"(?<![a-zA-Z])SK(?![a-zA-Z])", "에스케이"),
        (r"(?<![a-zA-Z])GS(?![a-zA-Z])", "지에스"),
        (r"(?<![a-zA-Z])CJ(?![a-zA-Z])", "씨제이"),
        (r"(?<![a-zA-Z])BJ(?![a-zA-Z])", "비제이"),
        (r"(?<![a-zA-Z])TS(?![a-zA-Z])", "티에스"),
        (r"(?<![a-zA-Z])YH(?![a-zA-Z])", "와이에이치"),
        (r"(?<![a-zA-Z])BL(?![a-zA-Z])", "블록"),
        (r"(?<![a-zA-Z])HDC(?![a-zA-Z])", "에이치디씨"),
        (r"(?<![a-zA-Z])DL(?![a-zA-Z])",  "디엘"),
    ]
    for pattern, replacement in abbr_map:
        result = re.sub(pattern, replacement, result, flags=re.IGNORECASE)

    return result


def _normalize_name_loose(name: str) -> str:
    """느슨한 정규화: N단지/N차도 제거 (fuzzy 매칭 fallback용)."""
    cleaned = re.sub(r"\([^)]*\)", "", name)
    cleaned = re.sub(r"\d+단지", "", cleaned)
    cleaned = re.sub(r"\d+차", "", cleaned)
    cleaned = re.sub(r"\d+블록", "", cleaned)
    cleaned = re.sub(r"\d+BL", "", cleaned, flags=re.IGNORECASE)
    cleaned = re.sub(r"아파트", "", cleaned)
    cleaned = _unify_brand(cleaned)
    cleaned = re.sub(r"[^\w가-힣]", "", cleaned.lower())
    return cleaned.strip()


def _calc_match_score(target: str, candidate: str) -> int:
    """두 단지명의 매칭 점수를 계산한다 (다단계 스코어링).

    Scoring tiers:
      100: 정규화 완전 일치
       97: 브랜드 통일 후 완전 일치 (엘지↔LG 등)
       95: loose 정규화 후 완전 일치 (N단지/N차 차이만)
       92: 브랜드 통일 + loose 정규화 후 완전 일치
       90: 부분 포함 + 길이 비율 >= 0.7
       80: 부분 포함 + 길이 비율 >= 0.5
       70: 부분 포함 + 길이 비율 < 0.5
    60-85: 토큰 Jaccard 유사도
    40-70: SequenceMatcher ratio >= 0.55
        0: 매칭 안됨

    Args:
        target: 매칭 대상 (정규화된 단지명)
        candidate: 후보 (정규화된 KB 단지명)

    Returns:
        매칭 점수 (0~100)
    """
    if not target or not candidate:
        return 0

    # Level 1: 완전 일치
    if target == candidate:
        return 100

    # Level 1.5: 브랜드 통일 후 완전 일치
    # _normalize_name에서 이미 _unify_brand를 호출하지만,
    # 기존 캐시 데이터와의 호환성을 위해 여기서도 한번 더 처리
    target_brand = re.sub(r"[^\w가-힣0-9]", "", _unify_brand(target).lower()).strip()
    cand_brand = re.sub(r"[^\w가-힣0-9]", "", _unify_brand(candidate).lower()).strip()
    if target_brand and cand_brand and target_brand == cand_brand:
        return 97

    # Level 2: loose 정규화 후 완전 일치 (N단지/N차/N블록/NBL 차이만 있는 경우)
    target_loose = _normalize_name_loose(target)
    cand_loose = _normalize_name_loose(candidate)
    if target_loose and cand_loose and target_loose == cand_loose:
        return 95

    # Level 2.5: 브랜드 통일 + loose (N단지/N차/N블록 제거)
    target_brand_loose = re.sub(r"\d+단지", "", re.sub(r"\d+차", "",
        re.sub(r"\d+블록", "", target_brand))).strip()
    cand_brand_loose = re.sub(r"\d+단지", "", re.sub(r"\d+차", "",
        re.sub(r"\d+블록", "", cand_brand))).strip()
    if target_brand_loose and cand_brand_loose and target_brand_loose == cand_brand_loose:
        return 92

    # Level 3: 부분 포함 (길이 비율에 따라 차등)
    # 브랜드 통일된 버전으로도 부분 포함 체크
    for t, c in [(target, candidate), (target_brand, cand_brand)]:
        if t in c or c in t:
            shorter = min(len(t), len(c))
            longer = max(len(t), len(c))
            ratio = shorter / longer if longer > 0 else 0
            if ratio >= 0.7:
                return 90
            elif ratio >= 0.5:
                return 80
            else:
                return 70

    # Level 4: 토큰 Jaccard 유사도 (한글 2+글자 + 숫자단지/차)
    # 브랜드 통일된 버전으로 토큰 추출
    tokens_t = set(re.findall(r"[가-힣]{2,}|\d+(?:단지|차)?", target_brand))
    tokens_c = set(re.findall(r"[가-힣]{2,}|\d+(?:단지|차)?", cand_brand))
    if tokens_t and tokens_c:
        intersection = tokens_t & tokens_c
        union = tokens_t | tokens_c
        jaccard = len(intersection) / len(union) if union else 0
        if jaccard > 0.3:
            # 0.3~1.0 → 60~85
            token_score = int(60 + (jaccard - 0.3) / 0.7 * 25)
            return min(token_score, 85)

    # Level 5: Fuzzy match (SequenceMatcher) — threshold 0.6→0.55로 완화
    # 브랜드 통일된 버전으로 비교
    seq_ratio = difflib.SequenceMatcher(None, target_brand, cand_brand).ratio()
    if seq_ratio >= 0.55:
        # 0.55~1.0 → 40~70
        fuzzy_score = int(40 + (seq_ratio - 0.55) / 0.45 * 30)
        return min(fuzzy_score, 70)

    return 0


def _filter_by_dong(
    kb_complexes: List[Dict[str, Any]],
    dong: str,
) -> List[Dict[str, Any]]:
    """KB 단지 목록을 동 이름으로 필터링.

    5자리 시군구코드 fallback으로 받은 전체 리스트에서
    주소 필드에 동 이름이 포함된 단지만 추출한다.

    Args:
        kb_complexes: KB API 반환 단지 목록
        dong: 동 이름 (예: "철산동")

    Returns:
        필터링된 리스트. 결과가 비어있으면 원본 반환.
    """
    if not dong:
        return kb_complexes

    # 읍/면 + 리 형식 처리: "기장읍 대라리" → "기장읍"으로도 매칭
    dong_parts = dong.split()
    dong_main = dong_parts[0] if dong_parts else dong

    filtered = [
        cx for cx in kb_complexes
        if dong_main in (cx.get("주소", "") or "")
    ]

    return filtered if filtered else kb_complexes
